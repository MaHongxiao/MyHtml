<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„é‡‘ä½™é¢å½•å…¥ - èµ„é‡‘é¢„ç®—ç®¡ç†ç³»ç»Ÿ</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        [x-cloak] { display: none !important; }
        body { font-family: 'Inter', 'Noto Sans SC', system-ui, -apple-system, sans-serif; background-color: #f8fafc; color: #334155; }
        .text-num { font-family: 'JetBrains Mono', 'Menlo', monospace; font-weight: 600; }
        .text-min { font-size: 13px; line-height: 1.5; }
        
        /* æ»šåŠ¨æ¡ */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        
        /* ç»Ÿè®¡å¡ç‰‡ */
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
            cursor: pointer;
        }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.08); }
        .stat-card.active { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        
        /* è¡¨æ ¼æ ·å¼ */
        .data-table th {
            background: #f8fafc;
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap;
        }
        .data-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
            vertical-align: middle;
            transition: all 0.15s;
        }
        .data-table tr:hover td { background: #f8fafc; }
        
        /* è¾“å…¥æ¡† */
        .smart-input {
            width: 100%;
            border: 1px solid #e2e8f0;
            background: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
            transition: all 0.2s;
            font-size: 14px;
        }
        .smart-input:hover { border-color: #94a3b8; }
        .smart-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .smart-input:disabled { background-color: #f8fafc; cursor: not-allowed; color: #64748b; border-color: #e2e8f0; }
        .smart-input.text-num { text-align: right; }
        
        /* åªè¯»å­—æ®µæ ·å¼ */
        .field-readonly {
            background-color: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            color: #334155;
            min-height: 36px;
            display: flex;
            align-items: center;
        }
        .field-readonly.text-num {
            font-family: 'JetBrains Mono', 'Menlo', monospace;
            justify-content: flex-end;
        }
        
        /* å¯ç¼–è¾‘å­—æ®µé«˜äº® */
        .editable-field {
            background-color: #fff;
            border: 1px solid #3b82f6;
            box-shadow: 0 0 0 1px rgba(59,130,246,0.1);
        }
        .editable-field:focus {
            border-color: #2563eb;
            box-shadow: 0 0 0 3px rgba(59,130,246,0.15);
        }
        
        /* çŠ¶æ€æ ‡ç­¾ */
        .status-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }
        .status-unfilled { background: #f3f4f6; color: #6b7280; border: 1px solid #e5e7eb; }
        .status-draft { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
        .status-pending { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
        .status-approved { background: #d1fae5; color: #065f46; border: 1px solid #6ee7b7; }
        .status-rejected { background: #fee2e2; color: #991b1b; border: 1px solid #fecaca; }
        
        /* ä¾§æ»‘é¢æ¿ */
        .slide-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 900px;
            height: 100vh;
            background: white;
            box-shadow: -10px 0 40px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
            display: flex;
            flex-direction: column;
        }
        .slide-panel.open { transform: translateX(0); }
        .slide-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .slide-overlay.open { opacity: 1; visibility: visible; }
        
        /* æŒ‰é’®æ ·å¼ */
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-primary:hover { background: #2563eb; }
        
        .btn-secondary {
            background: white;
            color: #475569;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-secondary:hover { background: #f8fafc; border-color: #cbd5e1; }
        
        .btn-success {
            background: #059669;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-success:hover { background: #047857; }
        
        .btn-danger {
            background: #dc2626;
            color: white;
            padding: 6px 12px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
        }
        .btn-danger:hover { background: #b91c1c; }
        
        /* æ“ä½œé“¾æ¥ */
        .action-link {
            color: #3b82f6;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .action-link:hover {
            color: #2563eb;
            background: #eff6ff;
            text-decoration: underline;
        }
        .action-link.danger {
            color: #dc2626;
        }
        .action-link.danger:hover {
            color: #b91c1c;
            background: #fee2e2;
        }
        .action-link.success {
            color: #059669;
        }
        .action-link.success:hover {
            color: #047857;
            background: #d1fae5;
        }
        .action-divider {
            color: #e2e8f0;
            margin: 0 4px;
        }
        
        /* Tabæ ·å¼ */
        .tab-btn {
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            background: none;
            cursor: pointer;
        }
        .tab-btn:hover { color: #3b82f6; }
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: #eff6ff;
        }
        
        /* åˆ†é¡µ */
        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #475569;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pagination-btn:hover:not(:disabled) {
            border-color: #3b82f6;
            color: #3b82f6;
        }
        .pagination-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        .pagination-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }
        
        /* Toast */
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: white;
            padding: 16px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border-left: 4px solid;
            z-index: 100;
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toast.show { transform: translateX(0); }
        .toast.success { border-color: #10b981; }
        .toast.error { border-color: #ef4444; }
        
        /* åŠ¨ç”» */
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        /* å®¡æ‰¹æ­¥éª¤ */
        .step-item { position: relative; flex: 1; text-align: center; }
        .step-item::before { content: ''; position: absolute; top: 14px; left: -50%; width: 100%; height: 2px; background: #e2e8f0; z-index: 0; }
        .step-item:first-child::before { display: none; }
        .step-item.completed::before { background: #10b981; }
        .step-item.active::before { background: #3b82f6; }
        .step-icon { width: 28px; height: 28px; background: #e2e8f0; color: #64748b; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; position: relative; z-index: 1; font-size: 12px; font-weight: 600; }
        .step-item.completed .step-icon { background: #10b981; color: white; }
        .step-item.active .step-icon { background: #3b82f6; color: white; }
        .step-item.rejected .step-icon { background: #ef4444; color: white; }

        /* è´¦æˆ·å¡ç‰‡æ–°æ ·å¼ */
        .account-card {
            background: white;
            border: 1px solid #e2e8f0;
            border-radius: 12px;
            overflow: hidden;
            transition: all 0.2s;
        }
        .account-card:hover {
            border-color: #cbd5e1;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
        }
        .account-header {
            background: linear-gradient(to right, #f8fafc, #ffffff);
            padding: 16px 20px;
            border-bottom: 1px solid #f1f5f9;
        }
        .account-body {
            padding: 20px;
        }
        .info-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 16px;
        }
        .info-item {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }
        .info-label {
            font-size: 12px;
            color: #64748b;
            font-weight: 500;
        }
        .info-value {
            font-size: 14px;
            color: #1e293b;
            font-weight: 600;
            word-break: break-all;
        }
        .info-value.num {
            font-family: 'JetBrains Mono', monospace;
        }
        .edit-section {
            background: #f0f9ff;
            border: 1px solid #bae6fd;
            border-radius: 8px;
            padding: 20px;
            margin-top: 16px;
        }
        .edit-section-title {
            font-size: 14px;
            font-weight: 600;
            color: #0369a1;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .calculation-hint {
            font-size: 12px;
            color: #0284c7;
            margin-top: 4px;
            font-style: italic;
        }
    </style>
<base target="_blank">
<base target="_blank">
</head>
<body class="h-screen flex flex-col overflow-hidden" x-data="fundBalanceApp()">

    <!-- é¡¶éƒ¨Header -->
    <header class="bg-white border-b border-slate-200 h-16 px-6 flex justify-between items-center shadow-sm z-30 flex-shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-gradient-to-br from-blue-600 to-blue-700 rounded-lg flex items-center justify-center shadow-lg shadow-blue-200">
                <i class="fa-solid fa-building-columns text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-slate-800">èµ„é‡‘ä½™é¢å½•å…¥</h1>
                <div class="text-xs text-slate-500 mt-0.5">å¡«æŠ¥æ—¥æœŸï¼šå½“æœˆ7æ—¥ã€14æ—¥ã€21æ—¥ã€å½“æœˆæœ€åä¸€ä¸ªå·¥ä½œæ—¥</div>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <button @click="refreshData()" class="btn-secondary">
                <i class="fa-solid fa-rotate-right" :class="loading ? 'animate-spin' : ''"></i> åˆ·æ–°
            </button>
            <button @click="autoGenerateData()" class="btn-primary">
                <i class="fa-solid fa-wand-magic-sparkles"></i> ç”ŸæˆåŸºç¡€æ•°æ®
            </button>
        </div>
    </header>

    <!-- Dashboard ç»Ÿè®¡åŒº -->
    <div class="bg-white border-b border-slate-200 px-6 py-5 grid grid-cols-2 md:grid-cols-5 gap-4 flex-shrink-0">
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'all'}" @click="currentTab = 'all'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å…¨éƒ¨è®°å½•</div>
                <div class="text-2xl font-bold text-slate-800" x-text="stats.total">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-600">
                <i class="fa-solid fa-layer-group text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'unfilled'}" @click="currentTab = 'unfilled'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å¾…å¡«æŠ¥</div>
                <div class="text-2xl font-bold text-amber-600" x-text="stats.unfilled">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-amber-600">
                <i class="fa-solid fa-file-pen text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'pending'}" @click="currentTab = 'pending'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å®¡æ‰¹ä¸­</div>
                <div class="text-2xl font-bold text-blue-600" x-text="stats.pending">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                <i class="fa-solid fa-clock text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'rejected'}" @click="currentTab = 'rejected'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å·²é©³å›</div>
                <div class="text-2xl font-bold text-red-600" x-text="stats.rejected">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-red-100 flex items-center justify-center text-red-600">
                <i class="fa-solid fa-circle-xmark text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'approved'}" @click="currentTab = 'approved'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å·²å®Œæˆ</div>
                <div class="text-2xl font-bold text-emerald-600" x-text="stats.approved">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                <i class="fa-solid fa-circle-check text-xl"></i>
            </div>
        </div>
    </div>

    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <main class="flex-1 overflow-hidden flex flex-col bg-slate-50">
        
        <!-- Tabåˆ‡æ¢ -->
        <div class="bg-white border-b border-slate-200 px-6 flex gap-1">
            <button class="tab-btn" :class="{'active': currentTab === 'all'}" @click="currentTab = 'all'">
                å…¨éƒ¨
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'unfilled'}" @click="currentTab = 'unfilled'">
                å¾…å¡«æŠ¥ <span class="ml-1 text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full" x-text="stats.unfilled">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'pending'}" @click="currentTab = 'pending'">
                å®¡æ‰¹ä¸­ <span class="ml-1 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full" x-text="stats.pending">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'rejected'}" @click="currentTab = 'rejected'">
                å·²é©³å› <span class="ml-1 text-xs bg-red-100 text-amber-700 px-2 py-0.5 rounded-full" x-text="stats.rejected">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'approved'}" @click="currentTab = 'approved'">
                å·²å®Œæˆ <span class="ml-1 text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full" x-text="stats.approved">0</span>
            </button>
        </div>

        <!-- é«˜çº§ç­›é€‰æ  -->
        <div class="bg-white border-b border-slate-200 p-4 flex flex-wrap gap-3 items-end shadow-sm">
            <div class="flex-1 min-w-[200px]">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æœºæ„åç§°</label>
                <select x-model="filters.orgName" class="smart-input">
                    <option value="">å…¨éƒ¨æœºæ„</option>
                    <template x-for="org in orgList" :key="org">
                        <option :value="org" x-text="org"></option>
                    </template>
                </select>
            </div>
            
            <div class="w-40">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æ•°æ®æœˆä»½</label>
                <input type="month" x-model="filters.month" class="smart-input">
            </div>
            
            <div class="w-48">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æ•°æ®æœŸæ¬¡</label>
                <select x-model="filters.period" class="smart-input">
                    <option value="">å…¨éƒ¨æœŸæ¬¡</option>
                    <option value="1-7æ—¥">1-7æ—¥</option>
                    <option value="8-14æ—¥">8-14æ—¥</option>
                    <option value="15-21æ—¥">15-21æ—¥</option>
                    <option value="22æ—¥-æœˆæœ«">22æ—¥-æœˆæœ«</option>
                </select>
            </div>
            
            <div class="w-32">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">å¡«æŠ¥çŠ¶æ€</label>
                <select x-model="filters.status" class="smart-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="unfilled">å¾…å¡«æŠ¥</option>
                    <option value="draft">å¾…æäº¤</option>
                    <option value="pending">å®¡æ‰¹ä¸­</option>
                    <option value="rejected">å·²é©³å›</option>
                    <option value="approved">å·²å®Œæˆ</option>
                </select>
            </div>
            
            <button @click="resetFilters()" class="btn-secondary mb-0.5 h-10">
                <i class="fa-solid fa-rotate-left mr-1"></i> é‡ç½®
            </button>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="flex-1 bg-white overflow-hidden flex flex-col m-6 rounded-xl border border-slate-200 shadow-sm">
            <div class="overflow-auto custom-scroll flex-1">
                <table class="w-full data-table">
                    <thead class="sticky top-0 z-10">
                        <tr>
                            <th class="w-10 text-center">#</th>
                            <th class="min-w-[220px]">æœºæ„åç§°</th>
                            <th class="w-32">æ•°æ®æœˆä»½</th>
                            <th class="w-48">æ•°æ®æœŸæ¬¡</th>
                            <th class="w-28 text-center">å¡«æŠ¥çŠ¶æ€</th>
                            <th class="w-24">å¡«æŠ¥äºº</th>
                            <th class="w-32">åˆ›å»ºæ—¥æœŸ</th>
                            <th class="w-32">å¡«æŠ¥æ—¥æœŸ</th>
                            <th class="w-32">æˆªæ­¢æ—¥æœŸ</th>
                            <th class="w-56 text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in paginatedData" :key="item.id">
                            <tr class="fade-in">
                                <td class="text-center text-slate-400" x-text="index + 1 + (currentPage - 1) * pageSize"></td>
                                <td>
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center text-xs font-bold" x-text="item.orgName.charAt(0)"></div>
                                        <span class="font-medium text-slate-800" x-text="item.orgName"></span>
                                    </div>
                                </td>
                                <td>
                                    <span class="text-num bg-slate-100 px-2 py-1 rounded text-xs font-medium text-slate-700" x-text="item.dataMonth"></span>
                                </td>
                                <td>
                                    <span class="text-num text-slate-700 font-medium" x-text="item.dataPeriod"></span>
                                </td>
                                <td class="text-center">
                                    <span class="status-tag" :class="'status-' + item.status">
                                        <i class="fa-solid fa-circle text-[8px]"></i>
                                        <span x-text="getStatusText(item.status)"></span>
                                    </span>
                                </td>
                                <td class="text-slate-600" x-text="item.filler || '-'"></td>
                                <td class="text-min text-slate-500" x-text="item.createDate"></td>
                                <td class="text-min text-slate-500" x-text="item.fillDate || '-'"></td>
                                <td class="text-min text-slate-500" x-text="item.deadline"></td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-1">
                                        <!-- å¾…å¡«æŠ¥çŠ¶æ€ï¼šæ˜¾ç¤ºã€å¡«æŠ¥ã€‘ -->
                                        <template x-if="item.status === 'unfilled'">
                                            <span class="action-link" @click="openFillModal(item)">
                                                <i class="fa-solid fa-pen-to-square"></i> å¡«æŠ¥
                                            </span>
                                        </template>
                                        
                                        <!-- å¾…æäº¤ï¼ˆè‰ç¨¿ï¼‰ï¼šæ˜¾ç¤º"æäº¤å®¡æ ¸ã€æ›´æ–°" -->
                                        <template x-if="item.status === 'draft'">
                                            <div class="flex items-center gap-1">
                                                <span class="action-link" @click="openFillModal(item)">
                                                    <i class="fa-solid fa-rotate"></i> æ›´æ–°
                                                </span>
                                                <span class="action-divider">|</span>
                                                <span class="action-link success" @click="submitAudit(item)">
                                                    <i class="fa-solid fa-paper-plane"></i> æäº¤å®¡æ ¸
                                                </span>
                                            </div>
                                        </template>
                                        
                                        <!-- å®¡æ‰¹ä¸­ï¼šæ˜¾ç¤º"å®¡æ‰¹ã€æ’¤å›" -->
                                        <template x-if="item.status === 'pending'">
                                            <div class="flex items-center gap-1">
                                                <span class="action-link" @click="openApprovalModal(item)">
                                                    <i class="fa-solid fa-gavel"></i> å®¡æ‰¹
                                                </span>
                                                <span class="action-divider">|</span>
                                                <span class="action-link" @click="openFillModal(item)">
                                                    <i class="fa-solid fa-eye"></i> æŸ¥çœ‹
                                                </span>
                                                <span class="action-divider">|</span>
                                                <span class="action-link danger" @click="withdrawItem(item)">
                                                    <i class="fa-solid fa-rotate-left"></i> æ’¤å›
                                                </span>
                                            </div>
                                        </template>
                                        
                                        <!-- å·²é©³å›ï¼šæ˜¾ç¤º"æ›´æ–°ã€é‡æ–°æäº¤" -->
                                        <template x-if="item.status === 'rejected'">
                                            <div class="flex items-center gap-1">
                                                <span class="action-link" @click="openFillModal(item)">
                                                    <i class="fa-solid fa-rotate"></i> æ›´æ–°
                                                </span>
                                                <span class="action-divider">|</span>
                                                <span class="action-link success" @click="resubmitItem(item)">
                                                    <i class="fa-solid fa-paper-plane"></i> é‡æ–°æäº¤
                                                </span>
                                            </div>
                                        </template>
                                        
                                        <!-- å·²å®Œæˆï¼ˆå·²å®¡æ ¸ï¼‰ï¼šæ˜¾ç¤º"æŸ¥çœ‹" -->
                                        <template x-if="item.status === 'approved'">
                                            <div class="flex items-center gap-1">
                                                <span class="text-min text-emerald-600 font-medium px-2">
                                                    <i class="fa-solid fa-check mr-1"></i>å·²å®Œæˆ
                                                </span>
                                                <span class="action-divider">|</span>
                                                <span class="action-link" @click="openFillModal(item)">
                                                    <i class="fa-solid fa-eye"></i> æŸ¥çœ‹
                                                </span>
                                            </div>
                                        </template>
                                    </div>
                                </td>
                            </tr>
                        </template>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <tr x-show="paginatedData.length === 0">
                            <td colspan="10" class="text-center py-16 text-slate-400">
                                <div class="mb-4 text-4xl">ğŸ“­</div>
                                <div class="text-min mb-2">æš‚æ— èµ„é‡‘ä½™é¢è®°å½•</div>
                                <button @click="autoGenerateData()" class="btn-primary mt-2">
                                    <i class="fa-solid fa-plus mr-1"></i> ç”ŸæˆåŸºç¡€æ•°æ®
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µ -->
            <div class="border-t border-slate-200 px-6 py-4 flex items-center justify-between bg-slate-50">
                <div class="text-xs text-slate-500">
                    æ˜¾ç¤º <span x-text="filteredData.length > 0 ? (currentPage - 1) * pageSize + 1 : 0" class="font-medium"></span> - 
                    <span x-text="Math.min(currentPage * pageSize, filteredData.length)" class="font-medium"></span> æ¡ï¼Œ
                    å…± <span x-text="filteredData.length" class="font-medium"></span> æ¡
                </div>
                <div class="flex gap-2">
                    <button @click="currentPage = 1" :disabled="currentPage === 1" class="pagination-btn">
                        <i class="fa-solid fa-angles-left"></i>
                    </button>
                    <button @click="currentPage--" :disabled="currentPage === 1" class="pagination-btn">
                        <i class="fa-solid fa-angle-left"></i>
                    </button>
                    
                    <template x-for="page in displayedPages" :key="page">
                        <button @click="currentPage = page" 
                                class="pagination-btn" 
                                :class="page === currentPage ? 'active' : ''"
                                x-text="page"></button>
                    </template>
                    
                    <button @click="currentPage++" :disabled="currentPage === totalPages" class="pagination-btn">
                        <i class="fa-solid fa-angle-right"></i>
                    </button>
                    <button @click="currentPage = totalPages" :disabled="currentPage === totalPages" class="pagination-btn">
                        <i class="fa-solid fa-angles-right"></i>
                    </button>
                </div>
                <div class="flex items-center gap-2 text-xs text-slate-500">
                    <select x-model.number="pageSize" @change="currentPage = 1" class="smart-input py-1 px-2 w-16 text-center">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                    <span>æ¡/é¡µ</span>
                </div>
            </div>
        </div>
    </main>

    <!-- å¡«æŠ¥ä¾§æ»‘é¢æ¿ - ä¼˜åŒ–ç‰ˆæœ¬ -->
    <div class="slide-overlay" :class="{'open': fillModal.open}" @click="closeFillModal()"></div>
    <div class="slide-panel" :class="{'open': fillModal.open}">
        <template x-if="fillModal.item">
            <div class="flex flex-col h-full">
                <!-- å¤´éƒ¨ -->
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-start bg-slate-50">
                    <div>
                        <div class="flex items-center gap-3 mb-1">
                            <h3 class="text-lg font-bold text-slate-800" x-text="canEdit(fillModal.item) ? 'èµ„é‡‘ä½™é¢å½•å…¥' : 'èµ„é‡‘ä½™é¢æŸ¥çœ‹'"></h3>
                            <span class="status-tag" :class="'status-' + fillModal.item.status" x-text="getStatusText(fillModal.item.status)"></span>
                        </div>
                        <p class="text-xs text-slate-500">
                            <span x-text="fillModal.item.orgName"></span> Â· 
                            <span x-text="fillModal.item.dataMonth"></span> Â· 
                            <span x-text="fillModal.item.dataPeriod"></span>
                        </p>
                    </div>
                    <button @click="closeFillModal()" class="text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 transition text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <!-- å†…å®¹åŒº -->
                <div class="flex-1 overflow-y-auto custom-scroll p-6 bg-slate-50/50">
                    <!-- å®¡æ‰¹è¿›åº¦ -->
                    <div x-show="fillModal.item.status !== 'unfilled' && fillModal.item.status !== 'draft'" class="mb-6 p-4 bg-white rounded-lg border border-slate-200 shadow-sm">
                        <div class="flex justify-between items-center mb-3">
                            <span class="text-sm font-bold text-slate-700">å®¡æ‰¹è¿›åº¦</span>
                            <span class="text-min text-slate-500" x-text="'å½“å‰çŠ¶æ€ï¼š' + getStatusText(fillModal.item.status)"></span>
                        </div>
                        <div class="flex justify-between px-2">
                            <template x-for="(step, idx) in approvalSteps" :key="idx">
                                <div class="step-item" :class="getStepClass(idx, fillModal.item.approvalStep, fillModal.item.status)">
                                    <div class="step-icon">
                                        <i class="fa-solid fa-check" x-show="idx < fillModal.item.approvalStep && fillModal.item.status !== 'rejected'"></i>
                                        <i class="fa-solid fa-xmark" x-show="fillModal.item.status === 'rejected' && idx === fillModal.item.approvalStep"></i>
                                        <span x-show="(fillModal.item.status !== 'rejected' && idx >= fillModal.item.approvalStep) || (fillModal.item.status === 'rejected' && idx !== fillModal.item.approvalStep)" x-text="idx + 1"></span>
                                    </div>
                                    <div class="text-xs mt-2 font-medium" x-text="step"></div>
                                </div>
                            </template>
                        </div>
                    </div>

                    <!-- é©³å›åŸå› æ˜¾ç¤º -->
                    <div x-show="fillModal.item.status === 'rejected' && fillModal.item.rejectReason" class="mb-6 p-4 bg-red-50 rounded-lg border border-red-200">
                        <div class="flex items-start gap-3">
                            <i class="fa-solid fa-circle-exclamation text-red-500 mt-0.5"></i>
                            <div>
                                <div class="text-sm font-bold text-red-700 mb-1">é©³å›åŸå› </div>
                                <div class="text-sm text-red-600" x-text="fillModal.item.rejectReason"></div>
                                <div class="text-min text-red-500 mt-2" x-text="'é©³å›äººï¼š' + fillModal.item.rejectBy + ' Â· ' + fillModal.item.rejectTime"></div>
                            </div>
                        </div>
                    </div>

                    <!-- åŸºæœ¬ä¿¡æ¯å¡ç‰‡ -->
                    <div class="bg-blue-50 border border-blue-200 rounded-lg p-4 mb-6">
                        <div class="grid grid-cols-3 gap-4 text-sm">
                            <div>
                                <span class="text-slate-500">æ•°æ®æœŸæ¬¡ï¼š</span>
                                <span class="font-medium text-slate-800" x-text="fillModal.item.dataPeriod"></span>
                            </div>
                            <div>
                                <span class="text-slate-500">å¡«æŠ¥æˆªæ­¢æ—¥æœŸï¼š</span>
                                <span class="font-medium text-slate-800" x-text="fillModal.item.deadline"></span>
                            </div>
                            <div>
                                <span class="text-slate-500">è´¦æˆ·æ•°é‡ï¼š</span>
                                <span class="font-medium text-slate-800" x-text="fillModal.accounts.length + ' ä¸ª'"></span>
                            </div>
                        </div>
                    </div>
                    
                    <!-- è´¦æˆ·ä½™é¢å½•å…¥åˆ—è¡¨ - æ–°ç‰ˆå¸ƒå±€ -->
                    <div class="space-y-6">
                        <div class="flex items-center justify-between mb-2">
                            <h4 class="text-sm font-bold text-slate-800">èµ„é‡‘ä½™é¢æ˜ç»†</h4>
                            <span class="text-xs text-slate-500" x-show="canEdit(fillModal.item)">
                                <i class="fa-solid fa-circle-info text-blue-500 mr-1"></i>
                                ä»…å¯ç¼–è¾‘è“è‰²æ¡†å†…å­—æ®µ
                            </span>
                        </div>
                        
                        <template x-for="(account, idx) in fillModal.accounts" :key="idx">
                            <div class="account-card">
                                <!-- è´¦æˆ·ä¿¡æ¯å¤´éƒ¨ - åªè¯»å±•ç¤º -->
                                <div class="account-header">
                                    <div class="flex items-center justify-between mb-3">
                                        <div class="flex items-center gap-2">
                                            <div class="w-8 h-8 rounded-full bg-blue-100 text-blue-600 flex items-center justify-center">
                                                <i class="fa-solid fa-building-columns text-sm"></i>
                                            </div>
                                            <div>
                                                <div class="font-bold text-slate-800" x-text="account.bankName"></div>
                                                <div class="text-xs text-slate-500 mt-0.5" x-text="account.accountName"></div>
                                            </div>
                                        </div>
                                        <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-xs font-medium" x-text="account.accountType"></span>
                                    </div>
                                    
                                    <!-- åŸºç¡€ä¿¡æ¯ç½‘æ ¼ - å…¨éƒ¨åªè¯» -->
                                    <div class="info-grid">
                                        <div class="info-item">
                                            <span class="info-label">é“¶è¡Œè´¦å·</span>
                                            <span class="info-value num text-slate-600" x-text="account.accountNo"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">é“¶ä¼ç›´è”</span>
                                            <span class="info-value" x-text="account.isDirectLink"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">NCç³»ç»ŸæŸ¥è¯¢</span>
                                            <span class="info-value" x-text="account.canQueryNC"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">è´¦æˆ·ç”¨é€”</span>
                                            <span class="info-value" x-text="account.accountUsage"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">è”ç³»äºº</span>
                                            <span class="info-value" x-text="account.contactPerson || '-'"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">è”ç³»ç”µè¯</span>
                                            <span class="info-value num" x-text="account.contactPhone || '-'"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">å¸ç§</span>
                                            <span class="info-value" x-text="account.currency || 'äººæ°‘å¸'"></span>
                                        </div>
                                        <div class="info-item">
                                            <span class="info-label">ç»†åˆ†ç±»å‹</span>
                                            <span class="info-value" x-text="account.subAccountType || 'æ´»æœŸ'"></span>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- å¯ç¼–è¾‘åŒºåŸŸ -->
                                <div class="account-body">
                                    <div class="edit-section">
                                        <div class="edit-section-title">
                                            <i class="fa-solid fa-pen-to-square"></i>
                                            ä½™é¢å½•å…¥ä¿¡æ¯
                                        </div>
                                        
                                        <div class="grid grid-cols-12 gap-4">
                                            <!-- æˆªæ­¢ç›®å‰è´¦æˆ·ä½™é¢ -->
                                            <div class="col-span-3">
                                                <label class="block text-sm font-bold text-slate-700 mb-2">
                                                    æˆªæ­¢ç›®å‰è´¦æˆ·ä½™é¢ <span class="text-red-500">*</span>
                                                </label>
                                                <div class="relative" x-show="canEdit(fillModal.item)">
                                                    <span class="absolute left-3 top-2.5 text-slate-400">Â¥</span>
                                                    <input type="number" x-model.number="account.balance" 
                                                           class="smart-input text-num pl-7 editable-field" 
                                                           placeholder="0.00" step="0.01"
                                                           @input="calculateRMB(account)">
                                                </div>
                                                <div x-show="!canEdit(fillModal.item)" 
                                                     class="field-readonly text-num justify-end" 
                                                     x-text="'Â¥' + formatMoney(account.balance)"></div>
                                            </div>

                                            <!-- å¤–å¸æŠ˜ç®—æ±‡ç‡ -->
                                            <div class="col-span-3">
                                                <label class="block text-sm font-bold text-slate-700 mb-2">
                                                    å¤–å¸æŠ˜ç®—æ±‡ç‡
                                                </label>
                                                <input type="number" x-model.number="account.exchangeRate" 
                                                       class="smart-input text-num" 
                                                       :class="canEdit(fillModal.item) ? 'editable-field' : ''"
                                                       placeholder="1.0000" step="0.0001"
                                                       @input="calculateRMB(account)"
                                                       :disabled="!canEdit(fillModal.item)">
                                                <div class="calculation-hint" x-show="account.currency !== 'äººæ°‘å¸' && account.currency">
                                                    éäººæ°‘å¸è´¦æˆ·è¯·å¡«å†™æ±‡ç‡
                                                </div>
                                            </div>

                                            <!-- äººæ°‘å¸é‡‘é¢ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼Œåªè¯»ï¼‰ -->
                                            <div class="col-span-3">
                                                <label class="block text-sm font-bold text-slate-700 mb-2">
                                                    äººæ°‘å¸é‡‘é¢
                                                    <span class="text-xs font-normal text-slate-400 ml-1">(è‡ªåŠ¨è®¡ç®—)</span>
                                                </label>
                                                <div class="field-readonly text-num justify-end bg-emerald-50 border-emerald-200 text-emerald-700 font-bold" 
                                                     x-text="'Â¥' + formatMoney((account.balance || 0) * (account.exchangeRate || 1))">
                                                </div>
                                                <div class="calculation-hint text-emerald-600">
                                                    ä½™é¢ Ã— æ±‡ç‡ = äººæ°‘å¸é‡‘é¢
                                                </div>
                                            </div>

                                            <!-- å¤‡æ³¨ -->
                                            <div class="col-span-3">
                                                <label class="block text-sm font-bold text-slate-700 mb-2">
                                                    å¤‡æ³¨
                                                </label>
                                                <input type="text" x-model="account.remark" 
                                                       class="smart-input" 
                                                       :class="canEdit(fillModal.item) ? 'editable-field' : ''"
                                                       placeholder="å¯é€‰å¡«å¤‡æ³¨ä¿¡æ¯" 
                                                       :disabled="!canEdit(fillModal.item)">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>
                    
                    <!-- åˆè®¡é‡‘é¢ -->
                    <div class="mt-6 bg-white rounded-lg p-5 border border-slate-200 shadow-sm sticky bottom-0">
                        <div class="flex justify-between items-center">
                            <div>
                                <span class="text-sm text-slate-600 font-medium">è´¦æˆ·ä½™é¢åˆè®¡ï¼ˆäººæ°‘å¸ï¼‰ï¼š</span>
                                <div class="text-xs text-slate-400 mt-1">æ ¹æ®å½•å…¥ä½™é¢è‡ªåŠ¨è®¡ç®—</div>
                            </div>
                            <span class="text-3xl font-bold text-num text-blue-600" 
                                  x-text="'Â¥' + formatMoney(fillModal.accounts.reduce((sum, a) => sum + ((a.balance || 0) * (a.exchangeRate || 1)), 0))">
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- åº•éƒ¨æ“ä½œ -->
                <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 flex justify-between items-center">
                    <button @click="closeFillModal()" class="btn-secondary">å…³é—­</button>
                    <div class="flex gap-2" x-show="canEdit(fillModal.item)">
                        <button @click="saveDraft()" class="btn-secondary">
                            <i class="fa-regular fa-floppy-disk"></i> ä¿å­˜è‰ç¨¿
                        </button>
                        <button @click="submitAuditFromModal()" class="btn-success">
                            <i class="fa-solid fa-paper-plane"></i> æäº¤å®¡æ ¸
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- å®¡æ‰¹å¼¹çª— -->
    <div class="slide-overlay" :class="{'open': approvalModal.open}" @click="closeApprovalModal()"></div>
    <div class="slide-panel" style="width: 900px;" :class="{'open': approvalModal.open}">
        <template x-if="approvalModal.item">
            <div class="flex flex-col h-full">
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-center bg-slate-50">
                    <div>
                        <h3 class="text-lg font-bold text-slate-800">å®¡æ‰¹æ“ä½œ</h3>
                        <p class="text-xs text-slate-500 mt-1" x-text="approvalModal.item.orgName + ' Â· ' + approvalModal.item.dataPeriod"></p>
                    </div>
                    <button @click="closeApprovalModal()" class="text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 transition text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <div class="flex-1 overflow-y-auto p-6">
                    <!-- å®¡æ‰¹ä¿¡æ¯å±•ç¤º -->
                    <div class="mb-6 p-4 bg-slate-50 rounded-lg border border-slate-200">
                        <div class="grid grid-cols-2 gap-4 text-sm mb-4">
                            <div>
                                <span class="text-slate-500">å¡«æŠ¥äººï¼š</span>
                                <span class="font-medium text-slate-800" x-text="approvalModal.item.filler || '-'"></span>
                            </div>
                            <div>
                                <span class="text-slate-500">å¡«æŠ¥æ—¥æœŸï¼š</span>
                                <span class="font-medium text-slate-800" x-text="approvalModal.item.fillDate || '-'"></span>
                            </div>
                            <div>
                                <span class="text-slate-500">è´¦æˆ·æ•°é‡ï¼š</span>
                                <span class="font-medium text-slate-800" x-text="approvalModal.accounts.length + ' ä¸ª'"></span>
                            </div>
                            <div>
                                <span class="text-slate-500">ä½™é¢åˆè®¡ï¼š</span>
                                <span class="font-medium text-blue-600 text-num" x-text="'Â¥' + formatMoney(approvalModal.accounts.reduce((sum, a) => sum + ((a.balance || 0) * (a.exchangeRate || 1)), 0))"></span>
                            </div>
                        </div>
                    </div>

                    <!-- è´¦æˆ·æ˜ç»†é¢„è§ˆ -->
                    <div class="mb-6">
                        <div class="flex items-center justify-between mb-3">
                            <h4 class="text-sm font-bold text-slate-800">è´¦æˆ·ä½™é¢æ˜ç»†é¢„è§ˆ</h4>
                            <span class="text-xs text-slate-500" x-text="'å…± ' + approvalModal.accounts.length + ' ä¸ªè´¦æˆ·'"></span>
                        </div>
                        <div class="overflow-x-auto custom-scroll border border-slate-200 rounded-lg">
                            <table class="w-full text-sm">
                                <thead class="bg-slate-50 sticky top-0">
                                    <tr>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">åºå·</th>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">é“¶è¡Œåç§°</th>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">è´¦æˆ·åç§°</th>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">é“¶è¡Œè´¦å·</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">è´¦æˆ·ç±»å‹</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">é“¶ä¼ç›´è”</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">NCæŸ¥è¯¢</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">è´¦æˆ·ç”¨é€”</th>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">è”ç³»äºº/ç”µè¯</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">å¸ç§</th>
                                        <th class="px-3 py-2 text-center text-xs font-semibold text-slate-600 border-b whitespace-nowrap">ç»†åˆ†ç±»å‹</th>
                                        <th class="px-3 py-2 text-right text-xs font-semibold text-slate-600 border-b whitespace-nowrap">ä½™é¢</th>
                                        <th class="px-3 py-2 text-right text-xs font-semibold text-slate-600 border-b whitespace-nowrap">æ±‡ç‡</th>
                                        <th class="px-3 py-2 text-right text-xs font-semibold text-slate-600 border-b whitespace-nowrap">äººæ°‘å¸é‡‘é¢</th>
                                        <th class="px-3 py-2 text-left text-xs font-semibold text-slate-600 border-b whitespace-nowrap">å¤‡æ³¨</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!-- ç©ºçŠ¶æ€æç¤º -->
                                    <tr x-show="!approvalModal.accounts || approvalModal.accounts.length === 0">
                                        <td colspan="15" class="px-4 py-8 text-center text-slate-400">
                                            <i class="fa-solid fa-inbox text-3xl mb-2"></i>
                                            <div class="text-sm">æš‚æ— è´¦æˆ·æ•°æ®</div>
                                        </td>
                                    </tr>
                                    <template x-for="(acc, idx) in approvalModal.accounts" :key="idx">
                                        <tr class="hover:bg-slate-50 transition">
                                            <td class="px-3 py-2 border-b text-slate-500" x-text="idx + 1"></td>
                                            <td class="px-3 py-2 border-b">
                                                <div class="font-medium text-slate-800 max-w-[150px] truncate" x-text="acc.bankName" :title="acc.bankName"></div>
                                            </td>
                                            <td class="px-3 py-2 border-b text-slate-700" x-text="acc.accountName"></td>
                                            <td class="px-3 py-2 border-b text-num text-slate-600 text-xs" x-text="acc.accountNo"></td>
                                            <td class="px-3 py-2 border-b text-center">
                                                <span class="px-2 py-0.5 bg-blue-50 text-blue-700 rounded text-xs" x-text="acc.accountType"></span>
                                            </td>
                                            <td class="px-3 py-2 border-b text-center">
                                                <span class="text-xs" :class="acc.isDirectLink === 'æ˜¯' ? 'text-emerald-600 font-medium' : 'text-slate-400'" x-text="acc.isDirectLink"></span>
                                            </td>
                                            <td class="px-3 py-2 border-b text-center">
                                                <span class="text-xs" :class="acc.canQueryNC === 'æ˜¯' ? 'text-emerald-600 font-medium' : 'text-slate-400'" x-text="acc.canQueryNC"></span>
                                            </td>
                                            <td class="px-3 py-2 border-b text-center">
                                                <span class="px-2 py-0.5 bg-slate-100 text-slate-700 rounded text-xs" x-text="acc.accountUsage"></span>
                                            </td>
                                            <td class="px-3 py-2 border-b text-xs">
                                                <div x-text="acc.contactPerson || '-'" class="text-slate-700"></div>
                                                <div x-text="acc.contactPhone || '-'" class="text-slate-400 text-min"></div>
                                            </td>
                                            <td class="px-3 py-2 border-b text-center text-slate-700" x-text="acc.currency || 'äººæ°‘å¸'"></td>
                                            <td class="px-3 py-2 border-b text-center">
                                                <span class="px-2 py-0.5 bg-amber-50 text-amber-700 rounded text-xs" x-text="acc.subAccountType || 'æ´»æœŸ'"></span>
                                            </td>
                                            <td class="px-3 py-2 border-b text-right text-num font-medium text-slate-800" x-text="'Â¥' + formatMoney(acc.balance)"></td>
                                            <td class="px-3 py-2 border-b text-right text-num text-slate-600" x-text="acc.exchangeRate || '1.0000'"></td>
                                            <td class="px-3 py-2 border-b text-right text-num font-bold text-blue-600" x-text="'Â¥' + formatMoney((acc.balance || 0) * (acc.exchangeRate || 1))"></td>
                                            <td class="px-3 py-2 border-b text-slate-600 max-w-[120px] truncate" :title="acc.remark" x-text="acc.remark || '-'"></td>
                                        </tr>
                                    </template>
                                </tbody>
                                <tfoot class="bg-slate-50 font-semibold">
                                    <tr>
                                        <td colspan="11" class="px-3 py-3 text-right text-slate-700">åˆè®¡ï¼ˆäººæ°‘å¸ï¼‰ï¼š</td>
                                        <td colspan="4" class="px-3 py-3 text-right text-num text-lg text-blue-600" x-text="'Â¥' + formatMoney(approvalModal.accounts.reduce((sum, a) => sum + ((a.balance || 0) * (a.exchangeRate || 1)), 0))"></td>
                                    </tr>
                                </tfoot>
                            </table>
                        </div>
                    </div>

                    <!-- å®¡æ‰¹æ“ä½œ -->
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-bold text-slate-700 mb-3">å®¡æ‰¹æ„è§</label>
                            <div class="flex gap-3">
                                <button @click="approvalModal.action = 'approve'" 
                                        class="flex-1 py-3 border-2 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2"
                                        :class="approvalModal.action === 'approve' ? 'border-emerald-500 bg-emerald-50 text-emerald-700' : 'border-slate-200 text-slate-600 hover:border-emerald-300'">
                                    <i class="fa-solid fa-check-circle text-lg"></i>
                                    <div class="text-left">
                                        <div>å®¡æ‰¹é€šè¿‡</div>
                                        <div class="text-xs opacity-75">ç›´æ¥å®Œæˆå®¡æ‰¹</div>
                                    </div>
                                </button>
                                <button @click="approvalModal.action = 'reject'" 
                                        class="flex-1 py-3 border-2 rounded-lg text-sm font-medium transition flex items-center justify-center gap-2"
                                        :class="approvalModal.action === 'reject' ? 'border-red-500 bg-red-50 text-red-700' : 'border-slate-200 text-slate-600 hover:border-red-300'">
                                    <i class="fa-solid fa-times-circle text-lg"></i>
                                    <div class="text-left">
                                        <div>é©³å›</div>
                                        <div class="text-xs opacity-75">éœ€å¡«å†™é©³å›åŸå› </div>
                                    </div>
                                </button>
                            </div>
                        </div>

                        <!-- é©³å›åŸå› è¾“å…¥æ¡† -->
                        <div x-show="approvalModal.action === 'reject'" x-transition>
                            <label class="block text-sm font-bold text-slate-700 mb-2">
                                é©³å›åŸå›  <span class="text-red-500">*</span>
                            </label>
                            <textarea x-model="approvalModal.reason" 
                                      rows="4" 
                                      class="smart-input resize-none" 
                                      placeholder="è¯·è¾“å…¥é©³å›åŸå› ï¼Œå¦‚ï¼šæ•°æ®æœ‰è¯¯ã€ç¼ºå°‘è´¦æˆ·ä¿¡æ¯ç­‰..."></textarea>
                            <p x-show="approvalModal.error" class="text-min text-red-500 mt-2" x-text="approvalModal.error"></p>
                        </div>
                    </div>
                </div>
                
                <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 flex justify-end gap-3">
                    <button @click="closeApprovalModal()" class="btn-secondary">å–æ¶ˆ</button>
                    <button @click="confirmApproval()" class="btn-primary" :class="{'bg-emerald-600 hover:bg-emerald-700': approvalModal.action === 'approve', 'bg-red-600 hover:bg-red-700': approvalModal.action === 'reject'}">
                        <i class="fa-solid" :class="approvalModal.action === 'approve' ? 'fa-check' : 'fa-times'"></i>
                        <span x-text="approvalModal.action === 'approve' ? 'ç¡®è®¤é€šè¿‡' : 'ç¡®è®¤é©³å›'"></span>
                    </button>
                </div>
            </div>
        </template>
    </div>

    <!-- Toast æç¤º -->
    <div class="toast" :class="[toast.type, {'show': toast.show}]">
        <div class="flex items-center gap-3">
            <i class="fa-solid" :class="toast.type === 'success' ? 'fa-check-circle text-emerald-500' : 'fa-circle-exclamation text-red-500'"></i>
            <div>
                <div class="font-medium text-slate-800" x-text="toast.title"></div>
                <div class="text-xs text-slate-500 mt-0.5" x-text="toast.message" x-show="toast.message"></div>
            </div>
        </div>
    </div>

    <script>
        function fundBalanceApp() {
            return {
                loading: false,
                currentTab: 'all',
                currentPage: 1,
                pageSize: 10,
                
                filters: {
                    orgName: '',
                    month: '',
                    period: '',
                    status: ''
                },
                
                // æœºæ„åˆ—è¡¨ï¼ˆæ¥è‡ªExcelçš„çœŸå®æ•°æ®ï¼‰
                orgList: [
                    'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€é›†å›¢æº¯æºæŠ€æœ¯æœåŠ¡æœ‰é™å…¬å¸',
                    'ä¸­æ£€ï¼ˆæ±Ÿè‹ï¼‰è®¡é‡æµ‹è¯•æœ‰é™å…¬å¸',
                    'ä¸­æ£€ååŒ—è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€ä¸–æ ‡ï¼ˆå—é€šï¼‰è®¡é‡æ£€æµ‹æœ‰é™å…¬å¸',
                    'ä¸­æ£€ï¼ˆå¹¿ä¸œï¼‰è®¡é‡æ£€æµ‹æŠ€æœ¯æœåŠ¡æœ‰é™å…¬å¸',
                    'ä¸­æ£€åä¸­è®¡é‡æ£€æµ‹ï¼ˆæ²³å—ï¼‰æœ‰é™å…¬å¸',
                    'å¹¿è¥¿ä¸­æ£€è®¡é‡æµ‹è¯•æœåŠ¡æœ‰é™å…¬å¸',
                    'ä¸­æ£€ä¸œåŒ—ï¼ˆè¾½å®ï¼‰è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€è¥¿å—è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€è¥¿åŒ—è®¡é‡æ£€æµ‹æœ‰é™å…¬å¸',
                    'ä¸­æ£€ï¼ˆæ·±åœ³ï¼‰è®¡é‡æµ‹è¯•æœåŠ¡æœ‰é™å…¬å¸'
                ],
                
                // å®¡æ‰¹æ­¥éª¤
                approvalSteps: ['éƒ¨é—¨é¢†å¯¼', 'è´¢åŠ¡å®¡æ ¸', 'è´¢åŠ¡ä¸»ç®¡', 'è´¢åŠ¡æ€»ç›‘'],
                
                // é“¶è¡Œè´¦å·åŸºç¡€æ•°æ®ï¼ˆæ¥è‡ªExcelï¼‰
                bankAccountTemplates: [
                    { bankName: 'ä¸­å›½å·¥å•†é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸åŒ—äº¬ç”µä¿¡å¤§æ¥¼æ”¯è¡Œ', accountName: 'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸', accountNo: '0200235219100040680', accountType: 'åŸºæœ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'ææ™“ä½³', contactPhone: '13717954707', accountUsage: 'æ”¯å‡ºæˆ·', subAccountType: 'æ´»æœŸ' },
                    { bankName: 'ä¸­å›½å·¥å•†é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸åŒ—äº¬ç¯å¸‚å£æ”¯è¡Œ', accountName: 'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸', accountNo: '0200209419200020807', accountType: 'ä¸€èˆ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'ææ™“ä½³', contactPhone: '13717954707', accountUsage: 'æ”¶å…¥æˆ·', subAccountType: 'æ´»æœŸ' },
                    { bankName: 'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸å†…éƒ¨æ´»æœŸæˆ·', accountName: 'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸', accountNo: '109-00-001', accountType: 'é›†å›¢å†…éƒ¨å­˜æ¬¾æˆ·', isDirectLink: 'å¦', canQueryNC: 'æ˜¯', contactPerson: 'ææ™“ä½³', contactPhone: '13717954707', accountUsage: 'å†…éƒ¨æˆ·', subAccountType: 'é›†å›¢å†…éƒ¨å­˜æ¬¾' },
                    { bankName: 'ä¸­å›½é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸è‹å·æœ¨æ¸æ”¯è¡Œ', accountName: 'ä¸­æ£€ï¼ˆæ±Ÿè‹ï¼‰è®¡é‡æµ‹è¯•æœ‰é™å…¬å¸', accountNo: '506676647371', accountType: 'åŸºæœ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'ç‹ç„¶', contactPhone: '18068284380', accountUsage: 'æ”¯å‡ºæˆ·', subAccountType: 'æ´»æœŸ' },
                    { bankName: 'ä¸­å›½é“¶è¡Œè‚¡ä»½æœ‰é™å…¬å¸æ˜†æ˜å¸‚æ»‡æ± è·¯æ”¯è¡Œ', accountName: 'ä¸­æ£€è¥¿å—è®¡é‡æœ‰é™å…¬å¸', accountNo: '134035776833', accountType: 'åŸºæœ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'æç«¹æ—', contactPhone: '18487166731', accountUsage: 'ä»˜æ¬¾æˆ·', subAccountType: 'æ´»æœŸ' },
                    { bankName: 'ä¸­å›½é“¶è¡Œè¥¿å®‰åŠ³åŠ¨å—è·¯æ”¯è¡Œ', accountName: 'ä¸­æ£€è¥¿åŒ—è®¡é‡æ£€æµ‹æœ‰é™å…¬å¸', accountNo: '103659440432', accountType: 'åŸºæœ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'éƒ­å«æœˆ', contactPhone: '18089240194', accountUsage: 'æ”¯å‡ºæˆ·', subAccountType: 'æ´»æœŸ' },
                    { bankName: 'ä¸­å›½å·¥å•†é“¶è¡Œæ·±åœ³äº‘åŸæ”¯è¡Œ', accountName: 'ä¸­æ£€ï¼ˆæ·±åœ³ï¼‰è®¡é‡æµ‹è¯•æœåŠ¡æœ‰é™å…¬å¸', accountNo: '4000024119200384729', accountType: 'ä¸€èˆ¬æˆ·', isDirectLink: 'æ˜¯', canQueryNC: 'æ˜¯', contactPerson: 'ç¨‹æ€é›¨', contactPhone: '18403693264', accountUsage: 'æ”¶å…¥æˆ·', subAccountType: 'æ´»æœŸ' }
                ],
                
                // ä¸»æ•°æ®åˆ—è¡¨
                dataList: [],
                
                // å¼¹çª—çŠ¶æ€
                fillModal: {
                    open: false,
                    item: null,
                    accounts: []
                },
                
                approvalModal: {
                    open: false,
                    item: null,
                    accounts: [],
                    action: 'approve',
                    reason: '',
                    error: ''
                },

                // ç›‘å¬å™¨ï¼Œç¡®ä¿ approvalModal æ‰“å¼€æ—¶æ•°æ®æ­£ç¡®
                watchApprovalModal() {
                    this.$watch('approvalModal.open', (value) => {
                        if (value && this.approvalModal.item) {
                            // å»¶è¿Ÿç¡®ä¿ DOM æ›´æ–°åå†æ£€æŸ¥æ•°æ®
                            setTimeout(() => {
                                if (!this.approvalModal.accounts || this.approvalModal.accounts.length === 0) {
                                    console.log('è´¦æˆ·æ•°æ®ä¸ºç©ºï¼Œé‡æ–°ç”Ÿæˆ...');
                                    this.approvalModal.accounts = this.generateMockAccounts(this.approvalModal.item);
                                }
                            }, 100);
                        }
                    });
                },
                
                toast: { show: false, type: 'success', title: '', message: '', timer: null },

                init() {
                    this.autoGenerateData();
                    this.watchApprovalModal();
                },

                // è‡ªåŠ¨ç”ŸæˆåŸºç¡€æ•°æ®
                autoGenerateData() {
                    const periods = [
                        { periodName: '2026å¹´1æœˆ1-7æ—¥', deadline: '2026-01-07', createDay: '01' },
                        { periodName: '2026å¹´1æœˆ8-14æ—¥', deadline: '2026-01-14', createDay: '08' },
                        { periodName: '2026å¹´1æœˆ15-21æ—¥', deadline: '2026-01-21', createDay: '15' },
                        { periodName: '2026å¹´1æœˆ22æ—¥-æœˆæœ«', deadline: '2026-01-31', createDay: '22' }
                    ];
                    
                    const newData = [];
                    let id = 1;
                    const selectedOrgs = this.orgList.slice(0, 8);
                    
                    selectedOrgs.forEach((org) => {
                        periods.forEach((period) => {
                            // éšæœºçŠ¶æ€åˆ†å¸ƒ
                            const rand = Math.random();
                            let status = 'unfilled';
                            let filler = '';
                            let fillDate = '';
                            let approvalStep = 0;
                            let rejectReason = '';
                            let rejectBy = '';
                            let rejectTime = '';
                            
                            if (rand > 0.3) {
                                if (rand > 0.85) {
                                    status = 'approved';  // å·²å®Œæˆ
                                    filler = ['å¼ è´¢åŠ¡', 'æä¼šè®¡', 'ç‹å‡ºçº³'][Math.floor(Math.random() * 3)];
                                    fillDate = `2026-01-${parseInt(period.createDay) + Math.floor(Math.random() * 3)}`;
                                    approvalStep = 4;
                                } else if (rand > 0.7) {
                                    status = 'rejected';  // å·²é©³å›
                                    filler = 'å½“å‰ç”¨æˆ·';
                                    fillDate = `2026-01-${parseInt(period.createDay) + 1}`;
                                    approvalStep = Math.floor(Math.random() * 3) + 1;
                                    rejectReason = 'æ•°æ®æ ¸å¯¹æœ‰è¯¯ï¼Œè¯·é‡æ–°æ£€æŸ¥è´¦æˆ·ä½™é¢ã€‚';
                                    rejectBy = ['éƒ¨é—¨é¢†å¯¼', 'è´¢åŠ¡å®¡æ ¸', 'è´¢åŠ¡ä¸»ç®¡'][approvalStep - 1];
                                    rejectTime = `2026-01-${parseInt(period.createDay) + 2} 14:30`;
                                } else if (rand > 0.5) {
                                    status = 'pending';   // å®¡æ‰¹ä¸­
                                    filler = ['å¼ è´¢åŠ¡', 'æä¼šè®¡'][Math.floor(Math.random() * 2)];
                                    fillDate = `2026-01-${parseInt(period.createDay) + 1}`;
                                    approvalStep = Math.floor(Math.random() * 3) + 1;
                                } else {
                                    status = 'draft';     // å¾…æäº¤
                                    filler = 'å½“å‰ç”¨æˆ·';
                                    fillDate = `2026-01-${parseInt(period.createDay) + 1}`;
                                }
                            }
                            
                            newData.push({
                                id: id++,
                                orgName: org,
                                dataMonth: '2026å¹´1æœˆ',
                                dataPeriod: period.periodName,
                                status: status,
                                filler: filler,
                                createDate: `2026-01-${period.createDay}`,
                                fillDate: fillDate,
                                deadline: period.deadline,
                                approvalStep: approvalStep,
                                rejectReason: rejectReason,
                                rejectBy: rejectBy,
                                rejectTime: rejectTime,
                                accountCount: Math.floor(Math.random() * 5) + 2,
                                totalBalance: Math.floor(Math.random() * 1000000),
                                accounts: []
                            });
                        });
                    });
                    
                    this.dataList = newData;
                    this.showToast('åŸºç¡€æ•°æ®å·²ç”Ÿæˆ', 'success', `å…±ç”Ÿæˆ ${newData.length} æ¡è®°å½•`);
                },

                get stats() {
                    return {
                        total: this.dataList.length,
                        unfilled: this.dataList.filter(d => d.status === 'unfilled').length,
                        draft: this.dataList.filter(d => d.status === 'draft').length,
                        pending: this.dataList.filter(d => d.status === 'pending').length,
                        rejected: this.dataList.filter(d => d.status === 'rejected').length,
                        approved: this.dataList.filter(d => d.status === 'approved').length
                    };
                },

                get filteredData() {
                    let data = this.dataList.filter(item => {
                        // Tabç­›é€‰
                        if (this.currentTab === 'unfilled' && item.status !== 'unfilled') return false;
                        if (this.currentTab === 'pending' && item.status !== 'pending') return false;
                        if (this.currentTab === 'rejected' && item.status !== 'rejected') return false;
                        if (this.currentTab === 'approved' && item.status !== 'approved') return false;
                        
                        // å…¶ä»–ç­›é€‰æ¡ä»¶
                        if (this.filters.orgName && !item.orgName.includes(this.filters.orgName)) return false;
                        if (this.filters.month) {
                            const monthStr = this.filters.month.replace('-', 'å¹´') + 'æœˆ';
                            if (!item.dataMonth.includes(monthStr)) return false;
                        }
                        if (this.filters.period && !item.dataPeriod.includes(this.filters.period)) return false;
                        if (this.filters.status && item.status !== this.filters.status) return false;
                        
                        return true;
                    });
                    
                    // æ’åº
                    data.sort((a, b) => {
                        const statusOrder = { 'unfilled': 0, 'draft': 1, 'rejected': 2, 'pending': 3, 'approved': 4 };
                        if (statusOrder[a.status] !== statusOrder[b.status]) {
                            return statusOrder[a.status] - statusOrder[b.status];
                        }
                        return new Date(a.deadline) - new Date(b.deadline);
                    });
                    
                    return data;
                },

                get paginatedData() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    return this.filteredData.slice(start, start + this.pageSize);
                },

                get totalPages() {
                    return Math.ceil(this.filteredData.length / this.pageSize) || 1;
                },

                get displayedPages() {
                    const pages = [];
                    const maxDisplay = 5;
                    let start = Math.max(1, this.currentPage - 2);
                    let end = Math.min(this.totalPages, start + maxDisplay - 1);
                    if (end - start < maxDisplay - 1) start = Math.max(1, end - maxDisplay + 1);
                    for (let i = start; i <= end; i++) pages.push(i);
                    return pages;
                },

                resetFilters() {
                    this.filters = { orgName: '', month: '', period: '', status: '' };
                    this.currentPage = 1;
                },

                getStatusText(status) {
                    const map = {
                        'unfilled': 'å¾…å¡«æŠ¥',
                        'draft': 'å¾…æäº¤',
                        'pending': 'å®¡æ‰¹ä¸­',
                        'rejected': 'å·²é©³å›',
                        'approved': 'å·²å®Œæˆ'
                    };
                    return map[status] || status;
                },

                getStepClass(idx, currentStep, status) {
                    if (status === 'rejected' && idx === currentStep) return 'rejected';
                    if (idx < currentStep) return 'completed';
                    if (idx === currentStep) return 'active';
                    return '';
                },

                canEdit(item) {
                    if (!item) return false;
                    return item.status === 'unfilled' || item.status === 'draft' || item.status === 'rejected';
                },

                // å¡«æŠ¥å¼¹çª—
                openFillModal(item) {
                    this.fillModal.item = JSON.parse(JSON.stringify(item));
                    
                    if (item.accounts && item.accounts.length > 0) {
                        this.fillModal.accounts = JSON.parse(JSON.stringify(item.accounts));
                    } else {
                        const accounts = [];
                        const orgTemplates = this.bankAccountTemplates.filter(t => 
                            item.orgName.includes(t.accountName.replace('æœ‰é™å…¬å¸', ''))
                        );
                        
                        if (orgTemplates.length > 0) {
                            orgTemplates.forEach(t => {
                                accounts.push({
                                    ...t,
                                    balance: item.status === 'unfilled' ? 0 : Math.floor(Math.random() * 1000000) + 1000,
                                    exchangeRate: 1,
                                    currency: 'äººæ°‘å¸',
                                    remark: ''
                                });
                            });
                        } else {
                            for (let i = 0; i < 2; i++) {
                                const template = this.bankAccountTemplates[i % this.bankAccountTemplates.length];
                                accounts.push({
                                    ...template,
                                    balance: item.status === 'unfilled' ? 0 : Math.floor(Math.random() * 1000000) + 1000,
                                    exchangeRate: 1,
                                    currency: 'äººæ°‘å¸',
                                    remark: ''
                                });
                            }
                        }
                        this.fillModal.accounts = accounts;
                    }
                    
                    this.fillModal.open = true;
                },

                closeFillModal() {
                    this.fillModal.open = false;
                    setTimeout(() => {
                        this.fillModal.item = null;
                        this.fillModal.accounts = [];
                    }, 300);
                },

                // å®¡æ‰¹å¼¹çª—
                openApprovalModal(item) {
                    this.approvalModal.item = JSON.parse(JSON.stringify(item));

                    // ä¼˜å…ˆä½¿ç”¨ item ä¸­å·²æœ‰çš„è´¦æˆ·æ•°æ®ï¼Œå¦‚æœæ²¡æœ‰åˆ™ç”Ÿæˆæ¨¡æ‹Ÿæ•°æ®
                    let accounts = [];
                    if (item.accounts && Array.isArray(item.accounts) && item.accounts.length > 0) {
                        accounts = JSON.parse(JSON.stringify(item.accounts));
                    } else {
                        accounts = this.generateMockAccounts(item);
                        // å°†ç”Ÿæˆçš„æ•°æ®ä¿å­˜åˆ°ä¸»æ•°æ®åˆ—è¡¨ä¸­ï¼Œæ–¹ä¾¿åç»­ä½¿ç”¨
                        const mainItem = this.dataList.find(d => d.id === item.id);
                        if (mainItem) {
                            mainItem.accounts = JSON.parse(JSON.stringify(accounts));
                        }
                    }

                    this.approvalModal.accounts = accounts;
                    this.approvalModal.action = 'approve';
                    this.approvalModal.reason = '';
                    this.approvalModal.error = '';
                    this.approvalModal.open = true;
                },

                closeApprovalModal() {
                    this.approvalModal.open = false;
                    setTimeout(() => {
                        this.approvalModal.item = null;
                        this.approvalModal.accounts = [];
                        this.approvalModal.reason = '';
                        this.approvalModal.error = '';
                    }, 300);
                },

                generateMockAccounts(item) {
                    const accounts = [];
                    const orgTemplates = this.bankAccountTemplates.filter(t => 
                        item.orgName.includes(t.accountName.replace('æœ‰é™å…¬å¸', ''))
                    );
                    
                    if (orgTemplates.length > 0) {
                        orgTemplates.forEach(t => {
                            accounts.push({
                                ...t,
                                balance: Math.floor(Math.random() * 1000000) + 1000,
                                exchangeRate: 1,
                                currency: 'äººæ°‘å¸',
                                remark: ''
                            });
                        });
                    }
                    return accounts;
                },

                confirmApproval() {
                    // é©³å›æ—¶å¿…é¡»å¡«å†™åŸå› 
                    if (this.approvalModal.action === 'reject') {
                        if (!this.approvalModal.reason.trim()) {
                            this.approvalModal.error = 'è¯·è¾“å…¥é©³å›åŸå› ';
                            return;
                        }
                    }

                    const item = this.dataList.find(d => d.id === this.approvalModal.item.id);
                    if (item) {
                        if (this.approvalModal.action === 'approve') {
                            // å®¡æ‰¹é€šè¿‡ -> å·²å®Œæˆ
                            item.status = 'approved';
                            item.approvalStep = 4;
                            this.showToast('å®¡æ‰¹é€šè¿‡', 'success', 'è¯¥è®°å½•å·²å®Œæˆå®¡æ‰¹');
                        } else {
                            // é©³å› -> å·²é©³å›
                            item.status = 'rejected';
                            item.rejectReason = this.approvalModal.reason;
                            item.rejectBy = 'å½“å‰å®¡æ‰¹äºº';
                            item.rejectTime = new Date().toLocaleString();
                            this.showToast('å·²é©³å›', 'error', 'å·²é€€å›ç»™å¡«æŠ¥äººä¿®æ”¹');
                        }
                    }
                    
                    this.closeApprovalModal();
                },

                // æ·»åŠ è®¡ç®—äººæ°‘å¸é‡‘é¢çš„æ–¹æ³•
                calculateRMB(account) {
                    // äººæ°‘å¸é‡‘é¢è‡ªåŠ¨è®¡ç®—ï¼Œæ— éœ€æ‰‹åŠ¨è®¾ç½®
                    // è¿™é‡Œå¯ä»¥æ·»åŠ å…¶ä»–é€»è¾‘ï¼Œå¦‚éªŒè¯ç­‰
                    if (!account.exchangeRate || account.exchangeRate <= 0) {
                        account.exchangeRate = 1;
                    }
                },

                saveDraft() {
                    if (this.fillModal.accounts.length === 0) {
                        this.showToast('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªè´¦æˆ·', 'error');
                        return;
                    }
                    
                    const item = this.dataList.find(d => d.id === this.fillModal.item.id);
                    if (item) {
                        item.status = 'draft';
                        item.accounts = JSON.parse(JSON.stringify(this.fillModal.accounts));
                        item.filler = 'å½“å‰ç”¨æˆ·';
                        item.fillDate = new Date().toLocaleString();
                        item.totalBalance = this.fillModal.accounts.reduce((sum, a) => sum + ((a.balance || 0) * (a.exchangeRate || 1)), 0);
                        this.showToast('ä¿å­˜æˆåŠŸ', 'success', 'å·²ä¿å­˜ä¸ºè‰ç¨¿');
                        this.closeFillModal();
                    }
                },

                submitAudit(item) {
                    if (confirm('ç¡®å®šæäº¤å®¡æ ¸å—ï¼Ÿæäº¤åå°†è¿›å…¥å®¡æ‰¹æµç¨‹ã€‚')) {
                        item.status = 'pending';
                        item.approvalStep = 0;
                        this.showToast('æäº¤æˆåŠŸ', 'success', 'å·²è¿›å…¥å®¡æ‰¹ä¸­çŠ¶æ€');
                    }
                },

                submitAuditFromModal() {
                    if (this.fillModal.accounts.length === 0) {
                        this.showToast('è¯·è‡³å°‘æ·»åŠ ä¸€ä¸ªè´¦æˆ·', 'error');
                        return;
                    }
                    
                    const invalid = this.fillModal.accounts.some(a => !a.balance && a.balance !== 0);
                    if (invalid) {
                        this.showToast('è¯·å¡«å†™æ‰€æœ‰è´¦æˆ·çš„ä½™é¢', 'error');
                        return;
                    }
                    
                    const item = this.dataList.find(d => d.id === this.fillModal.item.id);
                    if (item) {
                        item.status = 'pending';
                        item.accounts = JSON.parse(JSON.stringify(this.fillModal.accounts));
                        item.filler = 'å½“å‰ç”¨æˆ·';
                        item.fillDate = new Date().toLocaleString();
                        item.totalBalance = this.fillModal.accounts.reduce((sum, a) => sum + ((a.balance || 0) * (a.exchangeRate || 1)), 0);
                        item.approvalStep = 0;
                        this.showToast('æäº¤æˆåŠŸ', 'success', 'å·²è¿›å…¥å®¡æ‰¹ä¸­çŠ¶æ€');
                        this.closeFillModal();
                    }
                },

                resubmitItem(item) {
                    if (confirm('ç¡®å®šé‡æ–°æäº¤å®¡æ ¸å—ï¼Ÿ')) {
                        item.status = 'pending';
                        item.approvalStep = 0;
                        item.rejectReason = '';
                        item.rejectBy = '';
                        item.rejectTime = '';
                        this.showToast('é‡æ–°æäº¤æˆåŠŸ', 'success', 'å·²è¿›å…¥å®¡æ‰¹ä¸­çŠ¶æ€');
                    }
                },

                withdrawItem(item) {
                    if (confirm('ç¡®å®šæ’¤å›å—ï¼Ÿæ’¤å›åå°†è¿”å›åˆ°å¾…æäº¤çŠ¶æ€ã€‚')) {
                        item.status = 'draft';
                        item.approvalStep = 0;
                        this.showToast('æ’¤å›æˆåŠŸ', 'success', 'å·²è¿”å›å¾…æäº¤çŠ¶æ€');
                    }
                },

                refreshData() {
                    this.loading = true;
                    setTimeout(() => {
                        this.loading = false;
                        this.showToast('åˆ·æ–°æˆåŠŸ', 'success');
                    }, 800);
                },

                formatMoney(amount) {
                    return parseFloat(amount || 0).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                },

                showToast(title, type = 'success', message = '') {
                    if (this.toast.timer) clearTimeout(this.toast.timer);
                    this.toast = { show: true, type, title, message };
                    this.toast.timer = setTimeout(() => {
                        this.toast.show = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
