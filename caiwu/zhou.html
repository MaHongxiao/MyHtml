<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>èµ„é‡‘å‘¨è®¡åˆ’ç¼–åˆ¶ - èµ„é‡‘é¢„ç®—ç®¡ç†ç³»ç»Ÿ</title>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        [x-cloak] { display: none !important; }
        body { 
            font-family: 'Inter', 'PingFang SC', 'Microsoft YaHei', system-ui, sans-serif; 
            background-color: #f8fafc; 
            color: #334155; 
        }
        .text-num { font-family: 'JetBrains Mono', 'Menlo', monospace; font-weight: 600; }
        .text-min { font-size: 13px; line-height: 1.5; }
        
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 4px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        
        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            transition: all 0.2s;
            cursor: pointer;
        }
        .stat-card:hover { transform: translateY(-2px); box-shadow: 0 10px 25px -5px rgba(0,0,0,0.08); }
        .stat-card.active { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        
        .data-table th {
            background: #f8fafc;
            font-size: 12px;
            font-weight: 600;
            color: #64748b;
            padding: 12px 16px;
            text-align: left;
            border-bottom: 1px solid #e2e8f0;
            white-space: nowrap;
        }
        .data-table td {
            padding: 14px 16px;
            border-bottom: 1px solid #f1f5f9;
            font-size: 14px;
            vertical-align: middle;
            transition: all 0.15s;
        }
        .data-table tr:hover td { background: #f8fafc; }
        
        .smart-input {
            width: 100%;
            border: 1px solid #e2e8f0;
            background: #fff;
            padding: 8px 12px;
            border-radius: 6px;
            outline: none;
            transition: all 0.2s;
            font-size: 14px;
        }
        .smart-input:hover { border-color: #94a3b8; }
        .smart-input:focus { border-color: #3b82f6; box-shadow: 0 0 0 3px rgba(59,130,246,0.1); }
        .smart-input:disabled, .smart-input.readonly { 
            background-color: #f8fafc; 
            cursor: not-allowed; 
            color: #64748b; 
        }
        
        .status-tag {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 600;
            white-space: nowrap;
        }
        .status-unfilled { background: #f3f4f6; color: #6b7280; border: 1px solid #e5e7eb; }
        .status-draft { background: #fef3c7; color: #92400e; border: 1px solid #fcd34d; }
        .status-pending { background: #dbeafe; color: #1e40af; border: 1px solid #93c5fd; }
        .status-approved { background: #d1fae5; color: #065f46; border: 1px solid #6ee7b7; }
        
        .slide-panel {
            position: fixed;
            top: 0;
            right: 0;
            width: 95vw;
            max-width: 1200px;
            height: 100vh;
            background: white;
            box-shadow: -10px 0 40px rgba(0,0,0,0.1);
            transform: translateX(100%);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            z-index: 50;
            display: flex;
            flex-direction: column;
        }
        .slide-panel.open { transform: translateX(0); }
        .slide-overlay {
            position: fixed;
            inset: 0;
            background: rgba(15, 23, 42, 0.5);
            backdrop-filter: blur(4px);
            z-index: 40;
            opacity: 0;
            visibility: hidden;
            transition: all 0.3s;
        }
        .slide-overlay.open { opacity: 1; visibility: visible; }
        
        .btn-primary {
            background: #3b82f6;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-primary:hover { background: #2563eb; }
        .btn-primary:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .btn-secondary {
            background: white;
            color: #475569;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: 1px solid #e2e8f0;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-secondary:hover { background: #f8fafc; border-color: #cbd5e1; }
        
        .btn-success {
            background: #059669;
            color: white;
            padding: 8px 16px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.2s;
            border: none;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }
        .btn-success:hover { background: #047857; }
        
        .action-link {
            color: #3b82f6;
            font-size: 13px;
            cursor: pointer;
            transition: all 0.2s;
            padding: 4px 8px;
            border-radius: 4px;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }
        .action-link:hover { color: #2563eb; background: #eff6ff; text-decoration: underline; }
        .action-link.danger { color: #dc2626; }
        .action-link.danger:hover { color: #b91c1c; background: #fee2e2; }
        .action-divider { color: #e2e8f0; margin: 0 4px; }
        
        .tab-btn {
            padding: 10px 24px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-bottom: 2px solid transparent;
            transition: all 0.2s;
            background: none;
            cursor: pointer;
        }
        .tab-btn:hover { color: #3b82f6; }
        .tab-btn.active {
            color: #3b82f6;
            border-bottom-color: #3b82f6;
            background: #eff6ff;
        }
        
        .pagination-btn {
            padding: 6px 12px;
            border: 1px solid #e2e8f0;
            background: white;
            color: #475569;
            font-size: 13px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
        }
        .pagination-btn:hover:not(:disabled) { border-color: #3b82f6; color: #3b82f6; }
        .pagination-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .pagination-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .toast {
            position: fixed;
            top: 24px;
            right: 24px;
            background: white;
            padding: 16px 20px;
            border-radius: 10px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.15);
            border-left: 4px solid;
            z-index: 100;
            transform: translateX(120%);
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.265, 1.55);
        }
        .toast.show { transform: translateX(0); }
        .toast.success { border-color: #10b981; }
        .toast.error { border-color: #ef4444; }
        
        .fade-in { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .step-item { position: relative; flex: 1; text-align: center; }
        .step-item::before { content: ''; position: absolute; top: 14px; left: -50%; width: 100%; height: 2px; background: #e2e8f0; z-index: 0; }
        .step-item:first-child::before { display: none; }
        .step-item.completed::before { background: #10b981; }
        .step-item.active::before { background: #3b82f6; }
        .step-icon { width: 28px; height: 28px; background: #e2e8f0; color: #64748b; border-radius: 50%; display: inline-flex; align-items: center; justify-content: center; position: relative; z-index: 1; font-size: 12px; font-weight: 600; }
        .step-item.completed .step-icon { background: #10b981; color: white; }
        .step-item.active .step-icon { background: #3b82f6; color: white; }
        
        .plan-tab {
            padding: 8px 16px;
            font-size: 14px;
            font-weight: 500;
            color: #64748b;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            background: #f1f5f9;
            margin-right: 8px;
        }
        .plan-tab:hover { background: #e2e8f0; }
        .plan-tab.active { background: #3b82f6; color: white; }
        
        .readonly-field {
            background: #f8fafc;
            border: 1px solid #e2e8f0;
            padding: 8px 12px;
            border-radius: 6px;
            font-size: 14px;
            color: #64748b;
            min-height: 36px;
            display: flex;
            align-items: center;
        }
    </style>
</head>
<body class="h-screen flex flex-col overflow-hidden" x-data="weeklyPlanApp()">

    <!-- é¡¶éƒ¨Header -->
    <header class="bg-white border-b border-slate-200 h-16 px-6 flex justify-between items-center shadow-sm z-30 flex-shrink-0">
        <div class="flex items-center gap-4">
            <div class="w-10 h-10 bg-gradient-to-br from-violet-600 to-violet-700 rounded-lg flex items-center justify-center shadow-lg shadow-violet-200">
                <i class="fa-solid fa-calendar-week text-white text-lg"></i>
            </div>
            <div>
                <h1 class="text-lg font-bold text-slate-800">èµ„é‡‘å‘¨è®¡åˆ’ç¼–åˆ¶</h1>
                <div class="text-xs text-slate-500 mt-0.5">ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆå‘¨è®¡åˆ’ï¼Œç¡®è®¤åæäº¤å®¡æ ¸</div>
            </div>
        </div>
        
        <div class="flex items-center gap-3">
            <button @click="refreshData()" class="btn-secondary">
                <i class="fa-solid fa-rotate-right" :class="loading ? 'animate-spin' : ''"></i> åˆ·æ–°
            </button>
            <button @click="autoGenerateData()" class="btn-primary">
                <i class="fa-solid fa-wand-magic-sparkles"></i> ç”Ÿæˆæœ¬å‘¨æ•°æ®
            </button>
        </div>
    </header>

    <!-- Dashboard ç»Ÿè®¡åŒº -->
    <div class="bg-white border-b border-slate-200 px-6 py-5 grid grid-cols-2 md:grid-cols-5 gap-4 flex-shrink-0">
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'all'}" @click="currentTab = 'all'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å…¨éƒ¨è®¡åˆ’</div>
                <div class="text-2xl font-bold text-slate-800" x-text="stats.total">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-slate-100 flex items-center justify-center text-slate-600">
                <i class="fa-solid fa-layer-group text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'unfilled'}" @click="currentTab = 'unfilled'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å¾…å¡«æŠ¥</div>
                <div class="text-2xl font-bold text-amber-600" x-text="stats.unfilled">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-amber-100 flex items-center justify-center text-amber-600">
                <i class="fa-solid fa-file-pen text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'draft'}" @click="currentTab = 'draft'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å¾…æäº¤</div>
                <div class="text-2xl font-bold text-orange-600" x-text="stats.draft">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-orange-100 flex items-center justify-center text-orange-600">
                <i class="fa-solid fa-floppy-disk text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'pending'}" @click="currentTab = 'pending'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å®¡æ‰¹ä¸­</div>
                <div class="text-2xl font-bold text-blue-600" x-text="stats.pending">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-blue-100 flex items-center justify-center text-blue-600">
                <i class="fa-solid fa-clock text-xl"></i>
            </div>
        </div>
        
        <div class="stat-card flex items-center justify-between" :class="{'active': currentTab === 'approved'}" @click="currentTab = 'approved'">
            <div>
                <div class="text-xs text-slate-500 mb-1 font-medium">å·²å®¡æ ¸</div>
                <div class="text-2xl font-bold text-emerald-600" x-text="stats.approved">0</div>
            </div>
            <div class="w-12 h-12 rounded-full bg-emerald-100 flex items-center justify-center text-emerald-600">
                <i class="fa-solid fa-circle-check text-xl"></i>
            </div>
        </div>
    </div>

    <!-- ä¸»ä½“å†…å®¹åŒº -->
    <main class="flex-1 overflow-hidden flex flex-col bg-slate-50">
        
        <!-- Tabåˆ‡æ¢æ  -->
        <div class="bg-white border-b border-slate-200 px-6 flex gap-1">
            <button class="tab-btn" :class="{'active': currentTab === 'all'}" @click="currentTab = 'all'">
                å…¨éƒ¨
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'unfilled'}" @click="currentTab = 'unfilled'">
                æœªå¡«æŠ¥ <span class="ml-1 text-xs bg-amber-100 text-amber-700 px-2 py-0.5 rounded-full" x-text="stats.unfilled">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'draft'}" @click="currentTab = 'draft'">
                å¾…æäº¤ <span class="ml-1 text-xs bg-orange-100 text-orange-700 px-2 py-0.5 rounded-full" x-text="stats.draft">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'pending'}" @click="currentTab = 'pending'">
                å®¡æ‰¹ä¸­ <span class="ml-1 text-xs bg-blue-100 text-blue-700 px-2 py-0.5 rounded-full" x-text="stats.pending">0</span>
            </button>
            <button class="tab-btn" :class="{'active': currentTab === 'approved'}" @click="currentTab = 'approved'">
                å·²å®¡æ ¸ <span class="ml-1 text-xs bg-emerald-100 text-emerald-700 px-2 py-0.5 rounded-full" x-text="stats.approved">0</span>
            </button>
        </div>

        <!-- é«˜çº§ç­›é€‰æ  -->
        <div class="bg-white border-b border-slate-200 p-4 flex flex-wrap gap-3 items-end shadow-sm">
            <div class="flex-1 min-w-[200px]">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æœºæ„åç§°</label>
                <select x-model="filters.orgName" class="smart-input">
                    <option value="">å…¨éƒ¨æœºæ„</option>
                    <template x-for="org in orgList" :key="org">
                        <option :value="org" x-text="org"></option>
                    </template>
                </select>
            </div>
            
            <div class="w-40">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æ•°æ®æœˆä»½</label>
                <input type="month" x-model="filters.month" class="smart-input">
            </div>
            
            <div class="w-48">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">æ•°æ®æœŸæ¬¡</label>
                <select x-model="filters.period" class="smart-input">
                    <option value="">å…¨éƒ¨æœŸæ¬¡</option>
                    <option value="1-7æ—¥">1-7æ—¥</option>
                    <option value="8-14æ—¥">8-14æ—¥</option>
                    <option value="15-21æ—¥">15-21æ—¥</option>
                    <option value="22æ—¥-æœˆæœ«">22æ—¥-æœˆæœ«</option>
                </select>
            </div>
            
            <div class="w-32">
                <label class="block text-xs text-slate-500 mb-1.5 font-medium">å¡«æŠ¥çŠ¶æ€</label>
                <select x-model="filters.status" class="smart-input">
                    <option value="">å…¨éƒ¨</option>
                    <option value="unfilled">å¾…å¡«æŠ¥</option>
                    <option value="draft">å¾…æäº¤</option>
                    <option value="pending">å®¡æ‰¹ä¸­</option>
                    <option value="approved">å·²å®¡æ ¸</option>
                </select>
            </div>
            
            <button @click="resetFilters()" class="btn-secondary mb-0.5 h-10">
                <i class="fa-solid fa-rotate-left mr-1"></i> é‡ç½®
            </button>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="flex-1 bg-white overflow-hidden flex flex-col m-6 rounded-xl border border-slate-200 shadow-sm">
            <div class="overflow-auto custom-scroll flex-1">
                <table class="w-full data-table">
                    <thead class="sticky top-0 z-10">
                        <tr>
                            <th class="w-10 text-center">#</th>
                            <th class="min-w-[220px]">æœºæ„åç§°</th>
                            <th class="w-32">æ•°æ®æœˆä»½</th>
                            <th class="w-48">æ•°æ®æœŸæ¬¡</th>
                            <th class="w-28 text-center">å¡«æŠ¥çŠ¶æ€</th>
                            <th class="w-24">å¡«æŠ¥äºº</th>
                            <th class="w-32">åˆ›å»ºæ—¥æœŸ</th>
                            <th class="w-32">å¡«æŠ¥æ—¥æœŸ</th>
                            <th class="w-32">æˆªæ­¢æ—¥æœŸ</th>
                            <th class="w-48 text-center">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                        <template x-for="(item, index) in paginatedData" :key="item.id">
                            <tr class="fade-in">
                                <td class="text-center text-slate-400" x-text="index + 1 + (currentPage - 1) * pageSize"></td>
                                <td>
                                    <div class="flex items-center gap-2">
                                        <div class="w-8 h-8 rounded-full bg-violet-100 text-violet-600 flex items-center justify-center text-xs font-bold" x-text="item.orgName.charAt(0)"></div>
                                        <span class="font-medium text-slate-800" x-text="item.orgName"></span>
                                    </div>
                                </td>
                                <td>
                                    <span class="text-num bg-slate-100 px-2 py-1 rounded text-xs font-medium text-slate-700" x-text="item.dataMonth"></span>
                                </td>
                                <td>
                                    <span class="text-num text-slate-700 font-medium" x-text="item.dataPeriod"></span>
                                </td>
                                <td class="text-center">
                                    <span class="status-tag" :class="'status-' + item.status">
                                        <i class="fa-solid fa-circle text-[8px]"></i>
                                        <span x-text="getStatusText(item.status)"></span>
                                    </span>
                                </td>
                                <td class="text-slate-600" x-text="item.filler || '-'"></td>
                                <td class="text-min text-slate-500" x-text="item.createDate"></td>
                                <td class="text-min text-slate-500" x-text="item.fillDate || '-'"></td>
                                <td class="text-min text-slate-500" x-text="item.deadline"></td>
                                <td class="text-center">
                                    <div class="flex items-center justify-center gap-1">
                                        <!-- å¾…å¡«æŠ¥ï¼šæ˜¾ç¤ºã€å¡«æŠ¥ã€‘ -->
                                        <template x-if="item.status === 'unfilled'">
                                            <button @click="openFillModal(item)" class="btn-primary text-xs py-1.5">
                                                <i class="fa-solid fa-pen-to-square"></i> å¡«æŠ¥
                                            </button>
                                        </template>
                                        
                                        <!-- å¾…æäº¤ï¼šæ˜¾ç¤º"æäº¤å®¡æ ¸ã€æ›´æ–°" -->
                                        <template x-if="item.status === 'draft'">
                                            <div class="flex items-center gap-1">
                                                <button @click="openFillModal(item)" class="btn-secondary text-xs py-1.5">
                                                    <i class="fa-solid fa-rotate"></i> æ›´æ–°
                                                </button>
                                                <button @click="submitAudit(item)" class="btn-success text-xs py-1.5">
                                                    <i class="fa-solid fa-paper-plane"></i> æäº¤å®¡æ ¸
                                                </button>
                                            </div>
                                        </template>
                                        
                                        <!-- å®¡æ‰¹ä¸­ï¼šæ˜¾ç¤º"æŸ¥çœ‹ã€æ’¤å›" -->
                                        <template x-if="item.status === 'pending'">
                                            <div class="flex items-center gap-1">
                                                <button @click="openFillModal(item)" class="btn-secondary text-xs py-1.5">
                                                    <i class="fa-solid fa-eye"></i> æŸ¥çœ‹
                                                </button>
                                                <button @click="withdrawItem(item)" class="btn-secondary text-xs py-1.5 text-amber-600 border-amber-300 hover:bg-amber-50">
                                                    <i class="fa-solid fa-rotate-left"></i> æ’¤å›
                                                </button>
                                            </div>
                                        </template>
                                        
                                        <!-- å·²å®¡æ ¸ï¼šæ˜¾ç¤º"æŸ¥çœ‹" -->
                                        <template x-if="item.status === 'approved'">
                                            <div class="flex items-center gap-1">
                                                <span class="text-min text-emerald-600 font-medium px-2">
                                                    <i class="fa-solid fa-check mr-1"></i>å·²å®Œæˆ
                                                </span>
                                                <button @click="openFillModal(item)" class="btn-secondary text-xs py-1.5">
                                                    <i class="fa-solid fa-eye"></i> æŸ¥çœ‹
                                                </button>
                                            </div>
                                        </template>
                                    </div>
                                </td>
                            </tr>
                        </template>
                        
                        <!-- ç©ºçŠ¶æ€ -->
                        <tr x-show="paginatedData.length === 0">
                            <td colspan="10" class="text-center py-16 text-slate-400">
                                <div class="mb-4 text-4xl">ğŸ“…</div>
                                <div class="text-min mb-2">æš‚æ— èµ„é‡‘å‘¨è®¡åˆ’è®°å½•</div>
                                <button @click="autoGenerateData()" class="btn-primary mt-2">
                                    <i class="fa-solid fa-wand-magic-sparkles mr-1"></i> ç”Ÿæˆæœ¬å‘¨æ•°æ®
                                </button>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            
            <!-- åˆ†é¡µ -->
            <div class="border-t border-slate-200 px-6 py-4 flex items-center justify-between bg-slate-50">
                <div class="text-xs text-slate-500">
                    æ˜¾ç¤º <span x-text="filteredData.length > 0 ? (currentPage - 1) * pageSize + 1 : 0" class="font-medium"></span> - 
                    <span x-text="Math.min(currentPage * pageSize, filteredData.length)" class="font-medium"></span> æ¡ï¼Œ
                    å…± <span x-text="filteredData.length" class="font-medium"></span> æ¡
                </div>
                <div class="flex gap-2">
                    <button @click="currentPage = 1" :disabled="currentPage === 1" class="pagination-btn">
                        <i class="fa-solid fa-angles-left"></i>
                    </button>
                    <button @click="currentPage--" :disabled="currentPage === 1" class="pagination-btn">
                        <i class="fa-solid fa-angle-left"></i>
                    </button>
                    
                    <template x-for="page in displayedPages" :key="page">
                        <button @click="currentPage = page" 
                                class="pagination-btn" 
                                :class="page === currentPage ? 'active' : ''"
                                x-text="page"></button>
                    </template>
                    
                    <button @click="currentPage++" :disabled="currentPage === totalPages" class="pagination-btn">
                        <i class="fa-solid fa-angle-right"></i>
                    </button>
                    <button @click="currentPage = totalPages" :disabled="currentPage === totalPages" class="pagination-btn">
                        <i class="fa-solid fa-angles-right"></i>
                    </button>
                </div>
                <div class="flex items-center gap-2 text-xs text-slate-500">
                    <select x-model.number="pageSize" @change="currentPage = 1" class="smart-input py-1 px-2 w-16 text-center">
                        <option value="10">10</option>
                        <option value="20">20</option>
                        <option value="50">50</option>
                    </select>
                    <span>æ¡/é¡µ</span>
                </div>
            </div>
        </div>
    </main>

    <!-- å¡«æŠ¥/æŸ¥çœ‹ä¾§æ»‘é¢æ¿ -->
    <div class="slide-overlay" :class="{'open': fillModal.open}" @click="closeFillModal()"></div>
    <div class="slide-panel" :class="{'open': fillModal.open}">
        <template x-if="fillModal.item">
            <div class="flex flex-col h-full">
                <!-- å¤´éƒ¨ -->
                <div class="px-6 py-4 border-b border-slate-200 flex justify-between items-start bg-slate-50">
                    <div>
                        <div class="flex items-center gap-3 mb-1">
                            <h3 class="text-lg font-bold text-slate-800" x-text="canEdit(fillModal.item) ? 'èµ„é‡‘å‘¨è®¡åˆ’å¡«æŠ¥' : 'èµ„é‡‘å‘¨è®¡åˆ’æŸ¥çœ‹'"></h3>
                            <span class="status-tag" :class="'status-' + fillModal.item.status" x-text="getStatusText(fillModal.item.status)"></span>
                        </div>
                        <p class="text-xs text-slate-500">
                            <span x-text="fillModal.item.orgName"></span> Â· 
                            <span x-text="fillModal.item.dataMonth"></span> Â· 
                            <span x-text="fillModal.item.dataPeriod"></span>
                        </p>
                    </div>
                    <button @click="closeFillModal()" class="text-slate-400 hover:text-slate-600 w-8 h-8 flex items-center justify-center rounded-full hover:bg-slate-200 transition text-xl">
                        <i class="fa-solid fa-xmark"></i>
                    </button>
                </div>
                
                <!-- å®¡æ‰¹è¿›åº¦ -->
                <div x-show="fillModal.item.status !== 'unfilled' && fillModal.item.status !== 'draft'" class="px-6 py-4 bg-slate-50 border-b border-slate-200">
                    <div class="flex justify-between items-center mb-3">
                        <span class="text-sm font-bold text-slate-700">å®¡æ‰¹è¿›åº¦</span>
                        <span class="text-min text-slate-500" x-text="'å½“å‰çŠ¶æ€ï¼š' + getStatusText(fillModal.item.status)"></span>
                    </div>
                    <div class="flex justify-between px-2">
                        <template x-for="(step, idx) in approvalSteps" :key="idx">
                            <div class="step-item" :class="getStepClass(idx, fillModal.item.approvalStep, fillModal.item.status)">
                                <div class="step-icon">
                                    <i class="fa-solid fa-check" x-show="idx < fillModal.item.approvalStep"></i>
                                    <span x-show="idx >= fillModal.item.approvalStep" x-text="idx + 1"></span>
                                </div>
                                <div class="text-xs mt-2 font-medium" x-text="step"></div>
                            </div>
                        </template>
                    </div>
                </div>
                
                <!-- å­æ ‡ç­¾é¡µåˆ‡æ¢ -->
                <div class="px-6 py-3 border-b border-slate-200 bg-white flex items-center justify-between">
                    <div class="flex gap-2">
                        <button @click="fillModal.activeTab = 'detail'" class="plan-tab" :class="{'active': fillModal.activeTab === 'detail'}">
                            <i class="fa-solid fa-table-list mr-1"></i> å‘¨è®¡åˆ’æ˜ç»†
                        </button>
                        <button @click="fillModal.activeTab = 'summary'" class="plan-tab" :class="{'active': fillModal.activeTab === 'summary'}">
                            <i class="fa-solid fa-chart-pie mr-1"></i> å‘¨è®¡åˆ’æ±‡æ€»
                        </button>
                    </div>
                    <div class="text-xs text-slate-500" x-show="fillModal.item.status === 'unfilled' || fillModal.item.status === 'draft'">
                        <i class="fa-solid fa-circle-info text-blue-500 mr-1"></i>
                        ç³»ç»Ÿè‡ªåŠ¨ç”Ÿæˆï¼Œä»…å¤‡æ³¨å’Œè¯´æ˜å­—æ®µå¯ä¿®æ”¹
                    </div>
                </div>

                <!-- å†…å®¹åŒº -->
                <div class="flex-1 overflow-y-auto custom-scroll p-6 bg-slate-50">
                    <!-- å‘¨è®¡åˆ’æ˜ç»† -->
                    <div x-show="fillModal.activeTab === 'detail'" class="space-y-4">
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm overflow-hidden">
                            <div class="px-4 py-3 bg-slate-50 border-b border-slate-200 flex justify-between items-center">
                                <h4 class="font-bold text-slate-800">èµ„é‡‘é¡¹ç›®æ˜ç»†</h4>
                                <span class="text-xs text-slate-500" x-text="'ç”Ÿæˆæ—¥æœŸï¼š' + fillModal.item.createDate"></span>
                            </div>
                            <div class="overflow-x-auto">
                                <table class="w-full text-sm">
                                    <thead class="bg-slate-50 sticky top-0">
                                        <tr>
                                            <th class="px-3 py-3 text-left border-b border-slate-200 font-semibold text-slate-700 w-48">èµ„é‡‘é¡¹ç›®</th>
                                            <template x-for="dept in fillModal.departments" :key="dept">
                                                <th class="px-3 py-3 text-right border-b border-slate-200 font-semibold text-slate-700" x-text="dept"></th>
                                            </template>
                                            <th class="px-3 py-3 text-right border-b border-slate-200 font-semibold text-slate-700 bg-blue-50">åˆè®¡</th>
                                            <th class="px-3 py-3 text-left border-b border-slate-200 font-semibold text-slate-700 w-48">å¤‡æ³¨è¯´æ˜</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        <template x-for="(item, idx) in fillModal.detailData" :key="idx">
                                            <tr class="border-b border-slate-100 hover:bg-slate-50">
                                                <td class="px-3 py-3 font-medium" :class="item.isTotal ? 'text-slate-800 bg-slate-50 font-bold' : 'text-slate-700'" x-text="item.projectName"></td>
                                                <template x-for="(dept, dIdx) in fillModal.departments" :key="dIdx">
                                                    <td class="px-3 py-3 text-right text-num" :class="item.isTotal ? 'font-bold text-slate-800 bg-slate-50' : 'text-slate-600'" x-text="'Â¥' + formatMoney(item[dept] || 0)"></td>
                                                </template>
                                                <td class="px-3 py-3 text-right text-num font-bold text-blue-600 bg-blue-50" x-text="'Â¥' + formatMoney(item.total || 0)"></td>
                                                <td class="px-3 py-3">
                                                    <input x-show="!item.isTotal && canEdit(fillModal.item)" type="text" x-model="item.remark" class="smart-input text-sm" placeholder="è¯·è¾“å…¥å¤‡æ³¨...">
                                                    <span x-show="item.isTotal || !canEdit(fillModal.item)" class="text-slate-500 text-min" x-text="item.remark || '-'"></span>
                                                </td>
                                            </tr>
                                        </template>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- å‘¨è®¡åˆ’æ±‡æ€» -->
                    <div x-show="fillModal.activeTab === 'summary'" class="space-y-4">
                        <div class="bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                            <h4 class="font-bold text-slate-800 mb-4 flex items-center gap-2">
                                <i class="fa-solid fa-chart-pie text-violet-500"></i>
                                èµ„é‡‘æ±‡æ€»è¡¨
                            </h4>
                            
                            <div class="grid grid-cols-2 gap-6 mb-6">
                                <div class="space-y-4">
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">ä¸Šå‘¨èµ„é‡‘ä½™é¢</div>
                                        <div class="readonly-field text-num text-lg font-bold text-slate-800" x-text="'Â¥' + formatMoney(fillModal.summary.lastWeekBalance)"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨å›æ¬¾</div>
                                        <div class="readonly-field text-num text-lg font-bold text-emerald-600" x-text="'Â¥' + formatMoney(fillModal.summary.currentWeekIncome)"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨æ”¯å‡º</div>
                                        <div class="readonly-field text-num text-lg font-bold text-rose-600" x-text="'Â¥' + formatMoney(fillModal.summary.currentWeekExpense)"></div>
                                    </div>
                                    <div class="p-4 bg-blue-50 rounded-lg border border-blue-200">
                                        <div class="text-sm text-blue-600 mb-1">æœ¬å‘¨å®é™…èµ„é‡‘ä½™é¢</div>
                                        <div class="readonly-field text-num text-lg font-bold text-blue-700" x-text="'Â¥' + formatMoney(fillModal.summary.currentWeekBalance)"></div>
                                    </div>
                                </div>
                                
                                <div class="space-y-4">
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨è®¡åˆ’å›æ¬¾é‡‘é¢</div>
                                        <div class="readonly-field text-num font-bold text-emerald-600" x-text="'Â¥' + formatMoney(fillModal.summary.planIncome)"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨è®¡åˆ’æ”¯å‡ºé‡‘é¢</div>
                                        <div class="readonly-field text-num font-bold text-rose-600" x-text="'Â¥' + formatMoney(fillModal.summary.planExpense)"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨å®é™…å›æ¬¾é‡‘é¢</div>
                                        <div class="readonly-field text-num font-bold text-emerald-600" x-text="'Â¥' + formatMoney(fillModal.summary.actualIncome)"></div>
                                    </div>
                                    <div class="p-4 bg-slate-50 rounded-lg border border-slate-200">
                                        <div class="text-sm text-slate-500 mb-1">æœ¬å‘¨å®é™…æ”¯å‡ºé‡‘é¢</div>
                                        <div class="readonly-field text-num font-bold text-rose-600" x-text="'Â¥' + formatMoney(fillModal.summary.actualExpense)"></div>
                                    </div>
                                </div>
                            </div>

                            <div class="space-y-4 border-t border-slate-200 pt-4">
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">æœ¬å‘¨å›æ¬¾å·®å¼‚è¯´æ˜</label>
                                    <textarea x-model="fillModal.summary.incomeDiffRemark" :disabled="!canEdit(fillModal.item)" class="smart-input resize-none" rows="2" placeholder="å¦‚æœ‰å·®å¼‚è¯·è¯´æ˜åŸå› ..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">æœ¬å‘¨æ”¯å‡ºå·®å¼‚è¯´æ˜</label>
                                    <textarea x-model="fillModal.summary.expenseDiffRemark" :disabled="!canEdit(fillModal.item)" class="smart-input resize-none" rows="2" placeholder="å¦‚æœ‰å·®å¼‚è¯·è¯´æ˜åŸå› ..."></textarea>
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-slate-700 mb-2">ä¸Šå‘¨èµ„é‡‘ä½™é¢è¯´æ˜</label>
                                    <textarea x-model="fillModal.summary.lastWeekBalanceRemark" :disabled="!canEdit(fillModal.item)" class="smart-input resize-none" rows="2" placeholder="è¯·è¾“å…¥è¯´æ˜..."></textarea>
                                </div>
                                <div class="grid grid-cols-2 gap-4">
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-2">ä¸‹å‘¨è®¡åˆ’å›æ¬¾è¯´æ˜</label>
                                        <textarea x-model="fillModal.summary.nextWeekIncomeRemark" :disabled="!canEdit(fillModal.item)" class="smart-input resize-none" rows="2" placeholder="è¯·è¾“å…¥è¯´æ˜..."></textarea>
                                    </div>
                                    <div>
                                        <label class="block text-sm font-medium text-slate-700 mb-2">ä¸‹å‘¨è®¡åˆ’æ”¯å‡ºè¯´æ˜</label>
                                        <textarea x-model="fillModal.summary.nextWeekExpenseRemark" :disabled="!canEdit(fillModal.item)" class="smart-input resize-none" rows="2" placeholder="è¯·è¾“å…¥è¯´æ˜..."></textarea>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- åº•éƒ¨æ“ä½œ -->
                <div class="px-6 py-4 border-t border-slate-200 bg-slate-50 flex justify-between items-center">
                    <button @click="closeFillModal()" class="btn-secondary">å…³é—­</button>
                    <div class="flex gap-2" x-show="canEdit(fillModal.item)">
                        <button @click="saveDraft()" class="btn-secondary">
                            <i class="fa-regular fa-floppy-disk"></i> ä¿å­˜è‰ç¨¿
                        </button>
                        <button @click="submitAuditFromModal()" class="btn-success">
                            <i class="fa-solid fa-paper-plane"></i> æäº¤å®¡æ ¸
                        </button>
                    </div>
                </div>
            </div>
        </template>
    </div>

    <!-- Toast æç¤º -->
    <div class="toast" :class="[toast.type, {'show': toast.show}]">
        <div class="flex items-center gap-3">
            <i class="fa-solid" :class="toast.type === 'success' ? 'fa-check-circle text-emerald-500' : 'fa-circle-exclamation text-red-500'"></i>
            <div>
                <div class="font-medium text-slate-800" x-text="toast.title"></div>
                <div class="text-xs text-slate-500 mt-0.5" x-text="toast.message" x-show="toast.message"></div>
            </div>
        </div>
    </div>

    <script>
        function weeklyPlanApp() {
            return {
                loading: false,
                currentTab: 'all',
                currentPage: 1,
                pageSize: 10,
                
                filters: {
                    orgName: '',
                    month: '',
                    period: '',
                    status: ''
                },
                
                orgList: [
                    'ä¸­æ£€è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€é›†å›¢æº¯æºæŠ€æœ¯æœåŠ¡æœ‰é™å…¬å¸',
                    'ä¸­æ£€ï¼ˆæ±Ÿè‹ï¼‰è®¡é‡æµ‹è¯•æœ‰é™å…¬å¸',
                    'ä¸­æ£€ååŒ—è®¡é‡æœ‰é™å…¬å¸',
                    'ä¸­æ£€ä¸–æ ‡ï¼ˆå—é€šï¼‰è®¡é‡æ£€æµ‹æœ‰é™å…¬å¸',
                    'ä¸­æ£€ï¼ˆå¹¿ä¸œï¼‰è®¡é‡æ£€æµ‹æŠ€æœ¯æœåŠ¡æœ‰é™å…¬å¸',
                    'ä¸­æ£€åä¸­è®¡é‡æ£€æµ‹ï¼ˆæ²³å—ï¼‰æœ‰é™å…¬å¸',
                    'å¹¿è¥¿ä¸­æ£€è®¡é‡æµ‹è¯•æœåŠ¡æœ‰é™å…¬å¸'
                ],
                
                approvalSteps: ['éƒ¨é—¨é¢†å¯¼', 'è´¢åŠ¡å®¡æ ¸', 'è´¢åŠ¡ä¸»ç®¡', 'è´¢åŠ¡æ€»ç›‘'],
                
                dataList: [],
                
                fillModal: {
                    open: false,
                    item: null,
                    activeTab: 'detail',
                    departments: [],
                    detailData: [],
                    summary: {}
                },
                
                toast: { show: false, type: 'success', title: '', message: '', timer: null },

                init() {
                    this.autoGenerateData();
                },

                autoGenerateData() {
                    const periods = [
                        { name: '2026å¹´1æœˆ1-7æ—¥', days: '01-07' },
                        { name: '2026å¹´1æœˆ8-14æ—¥', days: '01-14' },
                        { name: '2026å¹´1æœˆ15-21æ—¥', days: '01-21' },
                        { name: '2026å¹´1æœˆ22æ—¥-æœˆæœ«', days: '01-31' }
                    ];
                    
                    const newData = [];
                    let id = 1;
                    
                    this.orgList.forEach((org) => {
                        periods.forEach((period, pIdx) => {
                            const rand = Math.random();
                            let status = 'unfilled';
                            let filler = '';
                            let fillDate = '';
                            let approvalStep = 0;
                            
                            if (rand > 0.4) {
                                if (rand > 0.9) {
                                    status = 'approved';
                                    filler = 'å¼ è´¢åŠ¡';
                                    fillDate = `2026-01-${String(pIdx * 7 + 2).padStart(2, '0')}`;
                                    approvalStep = 4;
                                } else if (rand > 0.75) {
                                    status = 'pending';
                                    filler = 'æä¼šè®¡';
                                    fillDate = `2026-01-${String(pIdx * 7 + 2).padStart(2, '0')}`;
                                    approvalStep = Math.floor(Math.random() * 3) + 1;
                                } else {
                                    status = 'draft';
                                    filler = 'å½“å‰ç”¨æˆ·';
                                    fillDate = `2026-01-${String(pIdx * 7 + 1).padStart(2, '0')}`;
                                }
                            }
                            
                            newData.push({
                                id: id++,
                                orgName: org,
                                dataMonth: '2026å¹´1æœˆ',
                                dataPeriod: period.name,
                                status: status,
                                filler: filler,
                                createDate: `2026-01-${String(pIdx * 7 + 1).padStart(2, '0')}`,
                                fillDate: fillDate,
                                deadline: `2026-${period.days}`,
                                approvalStep: approvalStep
                            });
                        });
                    });
                    
                    this.dataList = newData;
                    this.showToast('æ•°æ®å·²ç”Ÿæˆ', 'success', `å…±ç”Ÿæˆ ${newData.length} æ¡å‘¨è®¡åˆ’è®°å½•`);
                },

                get stats() {
                    return {
                        total: this.dataList.length,
                        unfilled: this.dataList.filter(d => d.status === 'unfilled').length,
                        draft: this.dataList.filter(d => d.status === 'draft').length,
                        pending: this.dataList.filter(d => d.status === 'pending').length,
                        approved: this.dataList.filter(d => d.status === 'approved').length
                    };
                },

                get filteredData() {
                    let data = this.dataList.filter(item => {
                        if (this.currentTab === 'unfilled' && item.status !== 'unfilled') return false;
                        if (this.currentTab === 'draft' && item.status !== 'draft') return false;
                        if (this.currentTab === 'pending' && item.status !== 'pending') return false;
                        if (this.currentTab === 'approved' && item.status !== 'approved') return false;
                        
                        if (this.filters.orgName && !item.orgName.includes(this.filters.orgName)) return false;
                        if (this.filters.month) {
                            const monthStr = this.filters.month.replace('-', 'å¹´') + 'æœˆ';
                            if (!item.dataMonth.includes(monthStr)) return false;
                        }
                        if (this.filters.period && !item.dataPeriod.includes(this.filters.period)) return false;
                        if (this.filters.status && item.status !== this.filters.status) return false;
                        
                        return true;
                    });
                    
                    data.sort((a, b) => {
                        const statusOrder = { 'unfilled': 0, 'draft': 1, 'pending': 2, 'approved': 3 };
                        if (statusOrder[a.status] !== statusOrder[b.status]) {
                            return statusOrder[a.status] - statusOrder[b.status];
                        }
                        return new Date(a.deadline) - new Date(b.deadline);
                    });
                    
                    return data;
                },

                get paginatedData() {
                    const start = (this.currentPage - 1) * this.pageSize;
                    return this.filteredData.slice(start, start + this.pageSize);
                },

                get totalPages() {
                    return Math.ceil(this.filteredData.length / this.pageSize) || 1;
                },

                get displayedPages() {
                    const pages = [];
                    const maxDisplay = 5;
                    let start = Math.max(1, this.currentPage - 2);
                    let end = Math.min(this.totalPages, start + maxDisplay - 1);
                    if (end - start < maxDisplay - 1) start = Math.max(1, end - maxDisplay + 1);
                    for (let i = start; i <= end; i++) pages.push(i);
                    return pages;
                },

                resetFilters() {
                    this.filters = { orgName: '', month: '', period: '', status: '' };
                    this.currentPage = 1;
                },

                getStatusText(status) {
                    const map = {
                        'unfilled': 'å¾…å¡«æŠ¥',
                        'draft': 'å¾…æäº¤',
                        'pending': 'å®¡æ‰¹ä¸­',
                        'approved': 'å·²å®¡æ ¸'
                    };
                    return map[status] || status;
                },

                getStepClass(idx, currentStep, status) {
                    if (idx < currentStep) return 'completed';
                    if (idx === currentStep) return 'active';
                    return '';
                },

                canEdit(item) {
                    return item && (item.status === 'unfilled' || item.status === 'draft');
                },

                openFillModal(item) {
                    this.fillModal.item = JSON.parse(JSON.stringify(item));
                    this.fillModal.activeTab = 'detail';
                    
                    // æ¨¡æ‹Ÿéƒ¨é—¨åˆ—è¡¨
                    this.fillModal.departments = ['è´¢åŠ¡éƒ¨', 'æœ‰æœºåˆ†æå®¤', 'æ— æœºåˆ†æå®¤', 'å¾®ç”Ÿç‰©éƒ¨'];
                    
                    // ç”Ÿæˆæ˜ç»†æ•°æ®ï¼ˆæ ¹æ®DM01é¡¹ç›®ç±»å‹ï¼‰
                    this.fillModal.detailData = this.generateDetailData();
                    
                    // ç”Ÿæˆæ±‡æ€»æ•°æ®
                    this.fillModal.summary = {
                        lastWeekBalance: Math.floor(Math.random() * 500000) + 100000,
                        currentWeekIncome: Math.floor(Math.random() * 300000) + 50000,
                        currentWeekExpense: Math.floor(Math.random() * 200000) + 30000,
                        currentWeekBalance: 0,
                        planIncome: Math.floor(Math.random() * 350000) + 60000,
                        planExpense: Math.floor(Math.random() * 250000) + 40000,
                        actualIncome: Math.floor(Math.random() * 320000) + 55000,
                        actualExpense: Math.floor(Math.random() * 220000) + 35000,
                        incomeDiffRemark: '',
                        expenseDiffRemark: '',
                        lastWeekBalanceRemark: '',
                        nextWeekIncomeRemark: '',
                        nextWeekExpenseRemark: ''
                    };
                    this.fillModal.summary.currentWeekBalance = 
                        this.fillModal.summary.lastWeekBalance + 
                        this.fillModal.summary.currentWeekIncome - 
                        this.fillModal.summary.currentWeekExpense;
                    
                    this.fillModal.open = true;
                },

                generateDetailData() {
                    // æ ¹æ®DM01é¡¹ç›®ç±»å‹ç”Ÿæˆ
                    const projects = [
                        { code: 'A00', name: 'é¢„è®¡å›æ¬¾å°è®¡', isTotal: true },
                        { code: 'A01', name: 'é”€å”®å›æ¬¾', isTotal: false },
                        { code: 'A02', name: 'ç­¹èµ„å›æ¬¾', isTotal: false },
                        { code: 'A04', name: 'å…¶ä»–å›æ¬¾', isTotal: false },
                        { code: 'B00', name: 'é¢„è®¡æ”¯å‡ºå°è®¡', isTotal: true },
                        { code: 'B10', name: 'æˆæœ¬æ”¯å‡º', isTotal: true },
                        { code: 'B11', name: 'äººå·¥æˆæœ¬æ”¯å‡º', isTotal: false },
                        { code: 'B12', name: 'ä¸šåŠ¡åä½œè´¹æ”¯å‡º', isTotal: false },
                        { code: 'B20', name: 'è´¹ç”¨æ”¯å‡º', isTotal: true },
                        { code: 'B21', name: 'é”€å”®è´¹ç”¨æ”¯å‡º', isTotal: false },
                        { code: 'B22', name: 'ç®¡ç†è´¹ç”¨æ”¯å‡º', isTotal: false },
                        { code: 'B30', name: 'ç¨è´¹æ”¯å‡º', isTotal: true }
                    ];
                    
                    return projects.map(p => {
                        const row = {
                            projectCode: p.code,
                            projectName: p.name,
                            isTotal: p.isTotal,
                            remark: ''
                        };
                        let total = 0;
                        this.fillModal.departments.forEach(dept => {
                            const val = p.isTotal ? 
                                Math.floor(Math.random() * 100000) + 10000 : 
                                Math.floor(Math.random() * 50000) + 5000;
                            row[dept] = val;
                            total += val;
                        });
                        row.total = total;
                        return row;
                    });
                },

                closeFillModal() {
                    this.fillModal.open = false;
                    setTimeout(() => {
                        this.fillModal.item = null;
                        this.fillModal.departments = [];
                        this.fillModal.detailData = [];
                        this.fillModal.summary = {};
                    }, 300);
                },

                saveDraft() {
                    const item = this.dataList.find(d => d.id === this.fillModal.item.id);
                    if (item) {
                        item.status = 'draft';
                        item.filler = 'å½“å‰ç”¨æˆ·';
                        item.fillDate = new Date().toISOString().split('T')[0];
                        this.showToast('ä¿å­˜æˆåŠŸ', 'success', 'å·²ä¿å­˜ä¸ºè‰ç¨¿');
                        this.closeFillModal();
                    }
                },

                submitAudit(item) {
                    if (confirm('ç¡®å®šæäº¤å®¡æ ¸å—ï¼Ÿæäº¤åå°†è¿›å…¥å®¡æ‰¹æµç¨‹ã€‚')) {
                        item.status = 'pending';
                        item.approvalStep = 0;
                        item.fillDate = new Date().toISOString().split('T')[0];
                        this.showToast('æäº¤æˆåŠŸ', 'success', 'å·²è¿›å…¥å®¡æ‰¹ä¸­çŠ¶æ€');
                    }
                },

                submitAuditFromModal() {
                    const item = this.dataList.find(d => d.id === this.fillModal.item.id);
                    if (item) {
                        item.status = 'pending';
                        item.approvalStep = 0;
                        item.filler = 'å½“å‰ç”¨æˆ·';
                        item.fillDate = new Date().toISOString().split('T')[0];
                        this.showToast('æäº¤æˆåŠŸ', 'success', 'å·²è¿›å…¥å®¡æ‰¹ä¸­çŠ¶æ€');
                        this.closeFillModal();
                    }
                },

                withdrawItem(item) {
                    if (confirm('ç¡®å®šæ’¤å›å—ï¼Ÿæ’¤å›åå°†è¿”å›åˆ°å¾…æäº¤çŠ¶æ€ã€‚')) {
                        item.status = 'draft';
                        item.approvalStep = 0;
                        this.showToast('æ’¤å›æˆåŠŸ', 'success', 'å·²è¿”å›å¾…æäº¤çŠ¶æ€');
                    }
                },

                refreshData() {
                    this.loading = true;
                    setTimeout(() => {
                        this.loading = false;
                        this.showToast('åˆ·æ–°æˆåŠŸ', 'success');
                    }, 800);
                },

                formatMoney(amount) {
                    return parseFloat(amount || 0).toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                },

                showToast(title, type = 'success', message = '') {
                    if (this.toast.timer) clearTimeout(this.toast.timer);
                    this.toast = { show: true, type, title, message };
                    this.toast.timer = setTimeout(() => {
                        this.toast.show = false;
                    }, 3000);
                }
            }
        }
    </script>
</body>
</html>
