<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>标书比对</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* --- Ant Design v5 Token System --- */
        :root {
            --ant-primary: #1677ff;
            --ant-primary-bg: #e6f4ff;
            --ant-success: #52c41a;
            --ant-warning: #faad14;
            --ant-error: #ff4d4f;
            --ant-text: rgba(0, 0, 0, 0.88);
            --ant-text-secondary: rgba(0, 0, 0, 0.45);
            --ant-border: #d9d9d9;
            --ant-bg-layout: #f0f2f5;
            --ant-bg-container: #ffffff;
            --ant-radius: 8px;
            --shadow-card: 0 1px 2px 0 rgba(0, 0, 0, 0.03), 0 1px 6px -1px rgba(0, 0, 0, 0.02);
        }

        body {
            margin: 0;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background-color: var(--ant-bg-layout);
            color: var(--ant-text);
            height: 100vh;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        /* --- Header --- */
        .header {
            height: 60px;
            background: #001529;
            color: #fff;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 24px;
            flex-shrink: 0;
        }

        /* --- Initial Setup Screen (Input) --- */
        .setup-container {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 20px;
            animation: fadeIn 0.4s ease;
        }
        
        .compare-grid {
            display: flex;
            gap: 40px;
            align-items: center;
            margin-bottom: 40px;
        }

        .file-slot {
            width: 400px;
            height: 400px;
            background: #fff;
            border-radius: var(--ant-radius);
            box-shadow: var(--shadow-card);
            display: flex;
            flex-direction: column;
            position: relative;
            transition: all 0.3s;
        }
        .file-slot:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.1); }

        .slot-header {
            padding: 16px;
            border-bottom: 1px solid #f0f0f0;
            font-weight: 600;
            background: #fafafa;
            border-radius: 8px 8px 0 0;
            display: flex; justify-content: space-between; align-items: center;
        }

        .tabs {
            display: flex;
            padding: 10px 20px;
            gap: 10px;
        }
        .tab-btn {
            flex: 1;
            padding: 8px;
            text-align: center;
            cursor: pointer;
            border-radius: 4px;
            font-size: 13px;
            background: #f5f5f5;
            color: var(--ant-text-secondary);
            transition: 0.2s;
        }
        .tab-btn.active {
            background: var(--ant-primary-bg);
            color: var(--ant-primary);
            font-weight: 500;
        }

        .drop-zone {
            flex: 1;
            margin: 20px;
            border: 2px dashed var(--ant-border);
            border-radius: 8px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: #fafafa;
        }
        .drop-zone:hover { border-color: var(--ant-primary); background: #f0f7ff; }

        .file-selected {
            display: none;
            flex: 1;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        .file-selected.active { display: flex; }

        .vs-badge {
            width: 60px; height: 60px;
            background: #fff;
            border-radius: 50%;
            display: flex; align-items: center; justify-content: center;
            font-weight: 900; font-size: 24px; color: #ccc;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
            z-index: 10;
        }

        /* --- Analysis Report Screen --- */
        .report-container {
            display: none; /* Hidden initially */
            flex: 1;
            flex-direction: column;
            overflow: hidden;
            animation: slideUp 0.4s ease;
        }

        .dashboard-bar {
            background: #fff;
            padding: 16px 24px;
            border-bottom: 1px solid #f0f0f0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric-group { display: flex; gap: 30px; }
        .metric { display: flex; align-items: center; gap: 10px; }
        .metric-val { font-size: 20px; font-weight: bold; }
        .metric-label { font-size: 12px; color: var(--ant-text-secondary); display: block; }
        .progress-mini { width: 60px; height: 4px; background: #f0f0f0; border-radius: 2px; margin-top: 4px; overflow: hidden; }
        .progress-mini-bar { height: 100%; border-radius: 2px; }

        .compare-viewer {
            flex: 1;
            display: flex;
            overflow: hidden;
            background: #e6e6e6; /* gap color */
            gap: 2px;
        }

        .doc-pane {
            flex: 1;
            background: #fff;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }
        .pane-header {
            padding: 10px 16px; background: #fafafa; border-bottom: 1px solid #eee;
            font-size: 13px; font-weight: 600; color: var(--ant-text-secondary);
            display: flex; justify-content: space-between;
        }
        .pane-content {
            flex: 1;
            padding: 40px;
            overflow-y: auto;
            scroll-behavior: smooth;
        }

        /* Content Simulation Styles */
        .doc-page {
            max-width: 800px; margin: 0 auto;
            min-height: 800px;
            background: #fff;
            position: relative;
        }
        
        /* Layout/Skeleton Mode */
        .layout-mode .text-block { color: transparent !important; background: #e0e0e0; border-radius: 4px; }
        .layout-mode .img-block { filter: grayscale(100%) opacity(0.3); border: 2px solid #ccc; }
        .layout-mode .heading { color: transparent !important; background: #bababa; width: fit-content; border-radius: 4px; }

        /* Highlight Styles */
        .diff-high { background-color: #ffccc7; border-bottom: 2px solid #ff4d4f; cursor: pointer; } /* High similarity/plagiarism */
        .diff-medium { background-color: #ffe58f; border-bottom: 2px solid #faad14; cursor: pointer; } /* Structure match */
        .diff-layout { border: 2px dashed #1677ff; padding: 2px; } /* Layout match */

        /* --- Components --- */
        .ant-btn {
            background: var(--ant-primary); color: #fff; border: none;
            padding: 8px 24px; border-radius: 6px; cursor: pointer; font-size: 14px;
            transition: 0.2s;
        }
        .ant-btn:hover { background: #4096ff; }
        .ant-btn-ghost { background: transparent; color: var(--ant-text); border: 1px solid #d9d9d9; }
        .ant-btn-ghost:hover { border-color: var(--ant-primary); color: var(--ant-primary); background: #fff; }

        .privacy-tip {
            margin-top: 10px;
            font-size: 12px;
            color: var(--ant-success);
            display: flex; align-items: center; gap: 4px;
            background: #f6ffed; padding: 4px 10px; border-radius: 4px; border: 1px solid #b7eb8f;
        }

        /* --- Modal for System Select --- */
        .modal-mask {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.45); z-index: 1000;
            display: none; align-items: center; justify-content: center;
        }
        .modal {
            width: 500px; background: #fff; border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            display: flex; flex-direction: column;
        }

        /* Loading Animation */
        .scanning-overlay {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(255,255,255,0.9); z-index: 2000;
            display: none; flex-direction: column; align-items: center; justify-content: center;
        }
        .scanner-line {
            width: 300px; height: 2px; background: var(--ant-primary);
            box-shadow: 0 0 10px var(--ant-primary);
            animation: scan 1.5s infinite alternate;
        }
        @keyframes scan { from { transform: translateY(-50px); width: 100px; } to { transform: translateY(50px); width: 300px; } }

    </style>
</head>
<body>



<div class="setup-container" id="setupView">
    <h2 style="margin-bottom: 5px;">选择两个文件进行深度比对</h2>
    <p style="color:var(--ant-text-secondary); margin-bottom:40px;">支持 DOCX, PDF 格式 | 分析结构、目录及排版风格</p>

    <div class="compare-grid">
        <div class="file-slot" id="slotA">
            <div class="slot-header">
                <span>基准标书 (文件A)</span>
                <span class="ant-tag" style="background:#e6f4ff; color:#1677ff; font-size:12px; padding:2px 6px; border-radius:4px;">Reference</span>
            </div>
            <div class="tabs">
                <div class="tab-btn active" onclick="switchTab('A', 'upload')">本地上传</div>
                <div class="tab-btn" onclick="switchTab('A', 'system')">系统库选择</div>
            </div>
            
            <div class="drop-zone" id="dropA" onclick="triggerFile('A')">
                <i class="ph ph-upload-simple" style="font-size:32px; color:#ccc; margin-bottom:10px;"></i>
                <div style="font-size:14px;">点击或拖拽文件</div>
                <div class="privacy-tip"><i class="ph ph-shield-check"></i> 隐私保护：比对后不留档</div>
            </div>

            <div class="file-selected" id="selectedA">
                <i class="ph ph-file-doc" style="font-size:48px; color:#1677ff; margin-bottom:10px;"></i>
                <div style="font-weight:500;" id="nameA">文件名</div>
                <button class="ant-btn ant-btn-ghost" style="margin-top:10px; padding:4px 12px; height:auto;" onclick="clearFile('A')">更换</button>
            </div>
        </div>

        <div class="vs-badge">VS</div>

        <div class="file-slot" id="slotB">
            <div class="slot-header">
                <span>比对标书 (文件B)</span>
                <span class="ant-tag" style="background:#fff7e6; color:#faad14; font-size:12px; padding:2px 6px; border-radius:4px;">Target</span>
            </div>
            <div class="tabs">
                <div class="tab-btn active" onclick="switchTab('B', 'upload')">本地上传</div>
                <div class="tab-btn" onclick="switchTab('B', 'system')">系统库选择</div>
            </div>

            <div class="drop-zone" id="dropB" onclick="triggerFile('B')">
                <i class="ph ph-upload-simple" style="font-size:32px; color:#ccc; margin-bottom:10px;"></i>
                <div style="font-size:14px;">点击或拖拽文件</div>
                <div class="privacy-tip"><i class="ph ph-shield-check"></i> 隐私保护：比对后不留档</div>
            </div>

            <div class="file-selected" id="selectedB">
                <i class="ph ph-file-pdf" style="font-size:48px; color:#ff4d4f; margin-bottom:10px;"></i>
                <div style="font-weight:500;" id="nameB">文件名</div>
                <button class="ant-btn ant-btn-ghost" style="margin-top:10px; padding:4px 12px; height:auto;" onclick="clearFile('B')">更换</button>
            </div>
        </div>
    </div>

    <button class="ant-btn" style="height: 44px; font-size: 16px; padding: 0 50px;" id="compareBtn" disabled onclick="startAnalysis()">
        开始多维比对
    </button>
</div>

<div class="scanning-overlay" id="loadingView">
    <div style="font-size:48px; margin-bottom:20px; color:#1677ff">
        <i class="ph ph-files"></i>
    </div>
    <div class="scanner-line"></div>
    <h3 style="margin-top:20px;">正在进行结构化分析...</h3>
    <p style="color:#888;">正在比对：目录树 / 文本指纹 / 版式骨架</p>
</div>

<div class="report-container" id="reportView">
    <div class="dashboard-bar">
        <div style="display:flex; align-items:center; gap:20px;">
            <div>
                <div style="font-size:24px; font-weight:bold; color:#ff4d4f;">82.5%</div>
                <div style="font-size:12px; color:#888;">综合相似度</div>
            </div>
            <div style="width:1px; height:30px; background:#e0e0e0;"></div>
            <div class="metric-group">
                <div>
                    <div class="metric-label">文本内容</div>
                    <div class="metric-val">90%</div>
                    <div class="progress-mini"><div class="progress-mini-bar" style="width:90%; background:#ff4d4f"></div></div>
                </div>
                <div>
                    <div class="metric-label">目录结构</div>
                    <div class="metric-val">100%</div>
                    <div class="progress-mini"><div class="progress-mini-bar" style="width:100%; background:#faad14"></div></div>
                </div>
                <div>
                    <div class="metric-label">排版风格</div>
                    <div class="metric-val">65%</div>
                    <div class="progress-mini"><div class="progress-mini-bar" style="width:65%; background:#1677ff"></div></div>
                </div>
            </div>
        </div>

        <div style="display:flex; gap:10px;">
            <div style="font-size:13px; color:#666; display:flex; align-items:center; gap:5px; margin-right:20px;">
                <span style="width:12px; height:12px; background:#ffccc7; border:1px solid #ff4d4f; display:inline-block;"></span> 内容雷同
                <span style="width:12px; height:12px; background:#fff7e6; border:1px solid #faad14; display:inline-block; margin-left:10px;"></span> 结构一致
            </div>
            <button class="ant-btn ant-btn-ghost" onclick="toggleLayoutMode()">
                <i class="ph ph-layout"></i> 切换版式/骨架视图
            </button>
            <button class="ant-btn">导出对比报告</button>
        </div>
    </div>

    <div class="compare-viewer">
        <div class="doc-pane">
            <div class="pane-header">
                <span id="resNameA">基准文件.docx</span>
                <span>Page 1/12</span>
            </div>
            <div class="pane-content" id="scrollA" onscroll="syncScroll('A')">
                <div class="doc-page" id="docAContent">
                    </div>
            </div>
        </div>

        <div class="doc-pane">
            <div class="pane-header">
                <span id="resNameB">比对文件.pdf</span>
                <span>Page 1/15</span>
            </div>
            <div class="pane-content" id="scrollB" onscroll="syncScroll('B')">
                <div class="doc-page" id="docBContent">
                    </div>
            </div>
        </div>
    </div>
</div>

<div class="modal-mask" id="systemModal">
    <div class="modal">
        <div style="padding:16px 24px; border-bottom:1px solid #eee; font-weight:600; display:flex; justify-content:space-between;">
            选择系统标书库文件
            <i class="ph ph-x" style="cursor:pointer;" onclick="closeModal()"></i>
        </div>
        <div style="padding:10px 24px;">
            <input type="text" placeholder="输入项目名称或编号搜索..." style="width:100%; padding:8px; border:1px solid #d9d9d9; border-radius:4px; margin-bottom:10px;">
            <div style="max-height:300px; overflow-y:auto;">
                <div onclick="selectSystemFile('2024年智慧水务一期技术标.docx')" style="padding:10px; border-bottom:1px solid #f0f0f0; cursor:pointer; display:flex; align-items:center; gap:8px; hover:bg-gray-50">
                    <i class="ph ph-file-doc" style="color:#1677ff"></i>
                    <div>
                        <div style="font-size:14px;">2024年智慧水务一期技术标.docx</div>
                        <div style="font-size:12px; color:#888;">版本: V2.0 | 上传人: 张三</div>
                    </div>
                </div>
                <div onclick="selectSystemFile('2023年省计量中心设备采购标书.pdf')" style="padding:10px; border-bottom:1px solid #f0f0f0; cursor:pointer; display:flex; align-items:center; gap:8px;">
                    <i class="ph ph-file-pdf" style="color:#ff4d4f"></i>
                    <div>
                        <div style="font-size:14px;">2023年省计量中心设备采购标书.pdf</div>
                        <div style="font-size:12px; color:#888;">版本: Final | 上传人: 李四</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
    // --- State Management ---
    let files = { A: null, B: null };
    let activeSlot = null; // Which slot opened the modal
    let isLayoutMode = false;

    // --- Input Logic ---
    function switchTab(slot, type) {
        // Toggle UI logic for tabs (simplified)
        const slotEl = document.getElementById(`slot${slot}`);
        const btns = slotEl.querySelectorAll('.tab-btn');
        btns.forEach(b => b.classList.remove('active'));
        // Find clicked button index (mock)
        if (type === 'system') {
            btns[1].classList.add('active');
            activeSlot = slot;
            openModal();
        } else {
            btns[0].classList.add('active');
        }
    }

    function openModal() { document.getElementById('systemModal').style.display = 'flex'; }
    function closeModal() { document.getElementById('systemModal').style.display = 'none'; }

    function triggerFile(slot) {
        // Mock File Upload
        const input = document.createElement('input');
        input.type = 'file';
        input.onchange = (e) => {
            if(e.target.files[0]) setFile(slot, e.target.files[0].name);
        };
        input.click();
    }

    function selectSystemFile(name) {
        setFile(activeSlot, name);
        closeModal();
    }

    function setFile(slot, name) {
        files[slot] = name;
        document.getElementById(`drop${slot}`).style.display = 'none';
        document.getElementById(`selected${slot}`).classList.add('active');
        document.getElementById(`name${slot}`).innerText = name;
        checkReady();
    }

    function clearFile(slot) {
        files[slot] = null;
        document.getElementById(`drop${slot}`).style.display = 'flex';
        document.getElementById(`selected${slot}`).classList.remove('active');
        checkReady();
    }

    function checkReady() {
        const btn = document.getElementById('compareBtn');
        btn.disabled = !(files.A && files.B);
        if (!btn.disabled) {
            btn.style.boxShadow = '0 4px 15px rgba(22, 119, 255, 0.4)';
        }
    }

    function resetSystem() {
        location.reload();
    }

    // --- Analysis Process ---
    function startAnalysis() {
        document.getElementById('setupView').style.display = 'none';
        document.getElementById('loadingView').style.display = 'flex';

        setTimeout(() => {
            document.getElementById('loadingView').style.display = 'none';
            document.getElementById('reportView').style.display = 'flex';
            renderContent();
            // Set filenames in header
            document.getElementById('resNameA').innerText = files.A;
            document.getElementById('resNameB').innerText = files.B;
        }, 2000);
    }

    // --- Viewer Logic ---
    function renderContent() {
        const contentA = `
            <h1 class="heading">第一章 技术方案概述</h1>
            <p class="text-block">本项目旨在构建一套覆盖全区域的智慧水务计量管理平台。平台应具备高可靠性、高并发处理能力。</p>
            <p class="text-block diff-high">在此基础上，结合最新的物联网技术，实现对水表数据的实时采集与监控。</p>
            
            <h2 class="heading diff-medium">1.1 系统架构设计</h2>
            <div class="img-block diff-layout" style="height:200px; background:#f0f0f0; margin:10px 0; display:flex; align-items:center; justify-content:center;">系统拓扑图 (Layout Match)</div>
            <p class="text-block diff-high">系统架构采用微服务设计模式，分为接入层、服务层和数据层，各层之间通过标准API接口通信。</p>
            
            <h2 class="heading diff-medium">1.2 核心功能指标</h2>
            <p class="text-block">系统响应时间应小于100ms，并发支持能力不低于5000 TPS。</p>
            <p class="text-block">...... (下文略)</p>
        `;

        const contentB = `
            <h1 class="heading">第一部分 项目技术概况</h1>
            <p class="text-block">本方案致力于打造全市统一的智能水务计量中心平台。系统需保证7x24小时不间断运行。</p>
            <p class="text-block diff-high">在此基础上，完全结合物联网技术，实现对水表数据的实时采集与监控。</p>
            
            <h2 class="heading diff-medium">1.1 系统架构设计</h2>
            <div class="img-block diff-layout" style="height:200px; background:#f0f0f0; margin:10px 0; display:flex; align-items:center; justify-content:center;">系统拓扑图 (Layout Match)</div>
            <p class="text-block diff-high">推荐系统架构采用Spring Cloud微服务设计模式，分为接入层、服务层和数据层。</p>
            
            <h2 class="heading diff-medium">1.2 性能指标要求</h2>
            <p class="text-block">平台核心接口响应时间需控制在100ms以内，高并发支持5000+。</p>
            <p class="text-block">...... (下文略)</p>
        `;

        document.getElementById('docAContent').innerHTML = contentA;
        document.getElementById('docBContent').innerHTML = contentB;
    }

    // --- View Mode Toggle ---
    function toggleLayoutMode() {
        isLayoutMode = !isLayoutMode;
        const conA = document.getElementById('docAContent');
        const conB = document.getElementById('docBContent');
        
        if (isLayoutMode) {
            conA.classList.add('layout-mode');
            conB.classList.add('layout-mode');
        } else {
            conA.classList.remove('layout-mode');
            conB.classList.remove('layout-mode');
        }
    }

    // --- Sync Scrolling (Simplified) ---
    function syncScroll(source) {
        const paneA = document.getElementById('scrollA');
        const paneB = document.getElementById('scrollB');
        
        if (source === 'A') {
            const percentage = paneA.scrollTop / (paneA.scrollHeight - paneA.clientHeight);
            paneB.scrollTop = percentage * (paneB.scrollHeight - paneB.clientHeight);
        } else {
            const percentage = paneB.scrollTop / (paneB.scrollHeight - paneB.clientHeight);
            paneA.scrollTop = percentage * (paneA.scrollHeight - paneA.clientHeight);
        }
    }

</script>

</body>
</html>
