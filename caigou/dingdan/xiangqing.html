<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>采购订单详情</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.13.3/dist/cdn.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        :root {
            --td-brand-color: #0052D9;
            --td-brand-color-hover: #003CAB;
            --td-error-color: #D54941;
            --td-success-color: #2BA471;
            --td-warning-color: #E37318;
            --td-text-color-primary: #1d1d1f;
            --td-text-color-secondary: #00000099;
            --td-bg-color-page: #f2f3f5;
        }

        [x-cloak] { display: none !important; }
        
        body { 
            font-family: "PingFang SC", "Microsoft YaHei", sans-serif; 
            background-color: var(--td-bg-color-page);
            color: var(--td-text-color-primary);
        }

        .t-btn {
            display: inline-flex; align-items: center; justify-content: center;
            height: 36px; padding: 0 24px; font-size: 14px; border-radius: 3px;
            cursor: pointer; transition: all 0.2s linear; border: 1px solid transparent; outline: none;
        }
        .t-btn-primary { background-color: var(--td-brand-color); color: white; }
        .t-btn-primary:hover { background-color: var(--td-brand-color-hover); }
        .t-btn-default { background-color: #fff; border-color: #dcdcdc; color: var(--td-text-color-primary); }
        .t-btn-default:hover { border-color: var(--td-brand-color); color: var(--td-brand-color); }

        .tab-nav { display: flex; border-bottom: 1px solid #e7e7e7; }
        .tab-item {
            padding: 12px 24px; cursor: pointer; font-weight: 500; color: var(--td-text-color-secondary);
            border-bottom: 2px solid transparent; transition: all 0.2s;
        }
        .tab-item.active { color: var(--td-brand-color); border-bottom-color: var(--td-brand-color); font-weight: 600; }
        .tab-item:hover:not(.active) { color: var(--td-text-color-primary); }

        .read-table th { background-color: #f7f8fa; color: var(--td-text-color-secondary); font-weight: 600; font-size: 13px; padding: 12px; text-align: left; }
        .read-table td { padding: 12px; border-bottom: 1px solid #f0f0f0; font-size: 13px; }
        .read-table tr:last-child td { border-bottom: none; }

        .info-card {
            background: #fff; border: 1px solid #e7e7e7; border-radius: 4px;
        }
        .info-card-header {
            padding: 12px 16px; border-bottom: 1px solid #f0f0f0; font-weight: 600; font-size: 14px;
            display: flex; align-items: center; gap: 8px;
        }
        .info-card-body { padding: 16px; }

        .status-tag {
            display: inline-flex; align-items: center; padding: 2px 8px; border-radius: 3px; font-size: 12px; font-weight: 600;
        }
        .status-waiting { background: #f2f3f5; color: #606266; border: 1px solid #e4e7ed; }
        .status-progress { background: #ecf5ff; color: #409eff; border: 1px solid #d9ecff; }
        .status-success { background: #f0f9eb; color: #67c23a; border: 1px solid #e1f3d8; }
        .status-warning { background: #fdf6ec; color: #e6a23c; border: 1px solid #f5dab1; }

        .supplier-tag {
            display: inline-flex; align-items: center; gap: 4px;
            padding: 2px 8px; background: #ecf5ff; color: #409eff;
            border-radius: 3px; font-size: 12px; border: 1px solid #d9ecff;
        }

        .progress-bar {
            height: 8px; background: #e7e7e7; border-radius: 4px; overflow: hidden;
        }
        .progress-fill {
            height: 100%; background: var(--td-brand-color); border-radius: 4px; transition: width 0.3s;
        }
        .progress-fill.warning { background: var(--td-warning-color); }
        .progress-fill.success { background: var(--td-success-color); }

        .timeline-item { position: relative; padding-left: 24px; padding-bottom: 24px; border-left: 2px solid #e7e7e7; }
        .timeline-item:last-child { border-left-color: transparent; }
        .timeline-dot {
            position: absolute; left: -6px; top: 0; width: 10px; height: 10px; border-radius: 50%;
            background: #fff; border: 2px solid var(--td-brand-color);
        }
        .timeline-item.success .timeline-dot { border-color: var(--td-success-color); background: var(--td-success-color); }
        .timeline-item.warning .timeline-dot { border-color: var(--td-warning-color); }
        
        .goods-img {
            width: 40px; height: 40px; background: #f5f7fa; border-radius: 4px;
            display: flex; align-items: center; justify-content: center; color: #909399; font-size: 12px;
        }
    </style>
</head>

<body x-data="orderDetail()">

    <!-- 顶部Header -->
    <div class="bg-white px-6 py-5 shadow-sm border-b border-gray-200 sticky top-0 z-30">
        <div class="max-w-[1400px] mx-auto">
            <div class="flex justify-between items-start mb-4">
                <div>
                    <div class="flex items-center gap-3">
                        <h1 class="text-xl font-bold text-gray-900" x-text="'采购订单：' + orderInfo.orderNo"></h1>
                        <span class="status-tag" :class="'status-' + orderInfo.statusType" x-text="orderInfo.status"></span>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">
                        提交人：<span class="text-gray-900" x-text="orderInfo.submitter"></span> &nbsp;|&nbsp; 
                        提交时间：<span x-text="orderInfo.submitTime"></span> &nbsp;|&nbsp;
                        申请机构：<span class="text-gray-900" x-text="orderInfo.institution"></span>
                    </p>
                </div>
                
                <div class="flex gap-2">
                    <button class="t-btn t-btn-default" @click="exportOrder()">
                        <i class="fa-solid fa-download mr-2"></i> 导出订单
                    </button>
                    <button class="t-btn t-btn-primary" @click="printOrder()" x-show="orderInfo.statusType === 'success'">
                        <i class="fa-solid fa-print mr-2"></i> 打印入库单
                    </button>
                </div>
            </div>

            <!-- 关键指标卡片 -->
            <div class="grid grid-cols-5 gap-4 bg-gray-50 border border-gray-200 rounded-lg p-4">
                <div class="border-r border-gray-200 pr-4">
                    <div class="text-xs text-gray-500 mb-1">订单总金额</div>
                    <div class="text-xl font-bold text-gray-900" x-text="'¥ ' + formatMoney(orderInfo.totalAmount)"></div>
                </div>
                <div class="border-r border-gray-200 pr-4 pl-4">
                    <div class="text-xs text-gray-500 mb-1">商品种类</div>
                    <div class="text-xl font-bold text-gray-900" x-text="orderInfo.productCount"></div>
                </div>
                <div class="border-r border-gray-200 pr-4 pl-4">
                    <div class="text-xs text-gray-500 mb-1">订购总数量</div>
                    <div class="text-xl font-bold text-gray-900" x-text="orderInfo.totalQuantity"></div>
                </div>
                <div class="border-r border-gray-200 pr-4 pl-4">
                    <div class="text-xs text-gray-500 mb-1">已到货数量</div>
                    <div class="text-xl font-bold text-blue-600" x-text="orderInfo.receivedQuantity"></div>
                </div>
                <div class="pl-4">
                    <div class="text-xs text-gray-500 mb-1">到货完成率</div>
                    <div class="flex items-center gap-2">
                        <div class="text-xl font-bold" :class="orderInfo.completionRate >= 100 ? 'text-green-600' : 'text-orange-600'" x-text="orderInfo.completionRate + '%'"></div>
                        <div class="w-16 progress-bar">
                            <div class="progress-fill" :class="orderInfo.completionRate >= 100 ? 'success' : 'warning'" :style="'width: ' + orderInfo.completionRate + '%'"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <main class="max-w-[1400px] mx-auto p-6 space-y-6">
        
        <div class="bg-white border border-gray-200 rounded-sm shadow-sm min-h-[600px]">
            <!-- Tab导航 -->
            <div class="tab-nav px-6 pt-2">
                <div class="tab-item" :class="currentTab === 'detail' ? 'active' : ''" @click="currentTab = 'detail'">
                    <i class="fa-solid fa-file-invoice mr-2"></i>订单明细
                </div>
                <div class="tab-item" :class="currentTab === 'delivery' ? 'active' : ''" @click="currentTab = 'delivery'">
                    <i class="fa-solid fa-truck-fast mr-2"></i>送货单进度
                    <span class="ml-1 bg-blue-100 text-blue-600 px-1.5 py-0.5 rounded-full text-xs" x-text="deliveryList.length"></span>
                </div>
                <div class="tab-item" :class="currentTab === 'log' ? 'active' : ''" @click="currentTab = 'log'">
                    <i class="fa-solid fa-clock-rotate-left mr-2"></i>到货日志
                    <span class="ml-1 bg-gray-100 text-gray-600 px-1.5 py-0.5 rounded-full text-xs" x-text="logList.length"></span>
                </div>
            </div>

            <div class="p-6">
                
                <!-- 订单明细Tab -->
                <div x-show="currentTab === 'detail'" x-transition>
                    <!-- 基本信息卡片 -->
                    <div class="info-card mb-6">
                        <div class="info-card-header">
                            <i class="fa-solid fa-circle-info text-blue-600"></i>
                            基本信息
                        </div>
                        <div class="info-card-body">
                            <div class="grid grid-cols-3 gap-x-8 gap-y-3">
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">申请部门</div>
                                    <div class="flex-1 font-medium text-sm" x-text="orderInfo.department"></div>
                                </div>
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">期望送达</div>
                                    <div class="flex-1 font-medium text-sm" x-text="orderInfo.deliveryDate"></div>
                                </div>
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">收货时间</div>
                                    <div class="flex-1 font-medium text-sm" x-text="orderInfo.deliveryTimeRange"></div>
                                </div>
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">紧急程度</div>
                                    <div class="flex-1">
                                        <span class="px-2 py-0.5 rounded text-xs border"
                                              :class="orderInfo.urgency === 'urgent' ? 'bg-orange-50 text-orange-600 border-orange-200' : 'bg-gray-50 text-gray-600 border-gray-200'"
                                              x-text="orderInfo.urgencyText"></span>
                                    </div>
                                </div>
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">周末配送</div>
                                    <div class="flex-1 font-medium text-sm" x-text="orderInfo.weekendDelivery"></div>
                                </div>
                                <div class="flex">
                                    <div class="w-24 text-gray-500 text-sm">审批人</div>
                                    <div class="flex-1 font-medium text-sm" x-text="orderInfo.approver"></div>
                                </div>
                                <div class="flex col-span-3">
                                    <div class="w-24 text-gray-500 text-sm">备注说明</div>
                                    <div class="flex-1 text-sm text-gray-600" x-text="orderInfo.remark || '无'"></div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 商品明细表格 -->
                    <h4 class="text-sm font-bold text-gray-800 border-l-4 border-blue-600 pl-3 mb-4">采购商品明细</h4>
                    <div class="overflow-x-auto border border-gray-200 rounded">
                        <table class="w-full read-table">
                            <thead>
                                <tr>
                                    <th class="w-10 text-center">#</th>
                                    <th class="min-w-[200px]">商品信息</th>
                                    <th class="w-24">CAS号</th>
                                    <th class="w-24">货号</th>
                                    <th class="w-32">规格</th>
                                    <th class="w-24">品牌</th>
                                    <th class="w-20 text-center">单位</th>
                                    <th class="w-24 text-right">单价(¥)</th>
                                    <th class="w-20 text-center">订购数</th>
                                    <th class="w-20 text-center">已到数</th>
                                    <th class="w-20 text-center">损耗数</th>
                                    <th class="w-24 text-right">小计(¥)</th>
                                </tr>
                            </thead>
                            <tbody>
                                <template x-for="(product, index) in products" :key="index">
                                    <tr>
                                        <td class="text-center text-gray-500" x-text="index + 1"></td>
                                        <td>
                                            <div class="flex items-center gap-3">
                                                <div class="goods-img">图片</div>
                                                <div>
                                                    <div class="font-medium text-gray-900" x-text="product.name"></div>
                                                    <div class="text-xs text-gray-500 mt-0.5" x-text="product.code"></div>
                                                </div>
                                            </div>
                                        </td>
                                        <td class="font-mono text-gray-600 text-xs" x-text="product.cas || '-'"></td>
                                        <td class="text-gray-600 text-xs" x-text="product.artNo || '-'"></td>
                                        <td class="text-gray-600 text-xs" x-text="product.spec"></td>
                                        <td class="text-gray-600 text-xs" x-text="product.brand || '-'"></td>
                                        <td class="text-center" x-text="product.unit"></td>
                                        <td class="text-right font-mono" x-text="formatMoney(product.price)"></td>
                                        <td class="text-center font-bold" x-text="product.quantity"></td>
                                        <td class="text-center text-blue-600 font-medium" x-text="product.received || 0"></td>
                                        <td class="text-center text-red-500 font-medium" x-text="product.loss || 0"></td>
                                        <td class="text-right font-mono font-bold" x-text="formatMoney(product.subtotal)"></td>
                                    </tr>
                                </template>
                                <tr class="bg-gray-50">
                                    <td colspan="12" class="text-right py-3">
                                        <span class="text-gray-600 mr-4">合计订购：<span class="font-bold" x-text="orderInfo.totalQuantity"></span> 件</span>
                                        <span class="text-gray-600 mr-4">合计到货：<span class="font-bold text-blue-600" x-text="orderInfo.receivedQuantity"></span> 件</span>
                                        <span class="text-gray-600 mr-4">合计损耗：<span class="font-bold text-red-500" x-text="orderInfo.lossQuantity"></span> 件</span>
                                        <span class="text-gray-900 font-bold text-lg ml-4">订单总额：¥ <span x-text="formatMoney(orderInfo.totalAmount)"></span></span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <!-- 送货单进度Tab -->
                <div x-show="currentTab === 'delivery'" x-transition>
                    <div class="mb-4 flex justify-between items-center">
                        <h4 class="text-sm font-bold text-gray-800 border-l-4 border-blue-600 pl-3">送货单执行进度</h4>
                        <span class="text-xs text-gray-500">共 <span class="font-bold text-gray-900" x-text="deliveryList.length"></span> 个送货单，按供应商拆分</span>
                    </div>

                    <div class="space-y-4">
                        <template x-for="(delivery, index) in deliveryList" :key="index">
                            <div class="border border-gray-200 rounded-lg overflow-hidden">
                                <!-- 送货单头部 -->
                                <div class="bg-gray-50 px-4 py-3 border-b border-gray-200 flex justify-between items-center">
                                    <div class="flex items-center gap-4">
                                        <span class="font-bold text-gray-900" x-text="delivery.deliveryNo"></span>
                                        <span class="supplier-tag">
                                            <i class="fa-solid fa-building"></i>
                                            <span x-text="delivery.supplierName"></span>
                                        </span>
                                        <span class="text-xs text-gray-500">
                                            生成时间：<span x-text="delivery.createTime"></span>
                                        </span>
                                    </div>
                                    <div class="flex items-center gap-3">
                                        <span class="status-tag" :class="'status-' + delivery.statusType" x-text="delivery.status"></span>
                                        <button class="text-blue-600 text-sm hover:underline" @click="toggleDeliveryDetail(index)">
                                            <i class="fa-solid" :class="delivery.expanded ? 'fa-chevron-up' : 'fa-chevron-down'"></i>
                                            <span x-text="delivery.expanded ? '收起' : '展开'"></span>
                                        </button>
                                    </div>
                                </div>

                                <!-- 进度概览 -->
                                <div class="p-4 grid grid-cols-4 gap-4 border-b border-gray-200">
                                    <div>
                                        <div class="text-xs text-gray-500 mb-1">商品种类</div>
                                        <div class="font-bold text-gray-900" x-text="delivery.productTypes + ' 种'"></div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 mb-1">订购总数</div>
                                        <div class="font-bold text-gray-900" x-text="delivery.totalQuantity + ' 件'"></div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 mb-1">到货进度</div>
                                        <div class="flex items-center gap-2">
                                            <span class="font-bold" :class="delivery.progress >= 100 ? 'text-green-600' : 'text-blue-600'" x-text="delivery.receivedQuantity + '/' + delivery.totalQuantity"></span>
                                            <div class="w-20 progress-bar">
                                                <div class="progress-fill" :class="delivery.progress >= 100 ? 'success' : ''" :style="'width: ' + delivery.progress + '%'"></div>
                                            </div>
                                            <span class="text-xs text-gray-500" x-text="delivery.progress + '%'"></span>
                                        </div>
                                    </div>
                                    <div>
                                        <div class="text-xs text-gray-500 mb-1">损耗情况</div>
                                        <div class="font-bold" :class="delivery.lossQuantity > 0 ? 'text-red-500' : 'text-gray-900'" x-text="delivery.lossQuantity + ' 件'"></div>
                                    </div>
                                </div>

                                <!-- 展开的明细 -->
                                <div x-show="delivery.expanded" x-collapse class="bg-white">
                                    <table class="w-full read-table">
                                        <thead class="bg-gray-50">
                                            <tr>
                                                <th class="w-10 text-center">#</th>
                                                <th>商品名称</th>
                                                <th class="w-32">规格</th>
                                                <th class="w-20 text-center">单位</th>
                                                <th class="w-20 text-center">订购数</th>
                                                <th class="w-20 text-center">已送货</th>
                                                <th class="w-20 text-center">入库数</th>
                                                <th class="w-20 text-center text-red-500">损耗数</th>
                                                <th class="w-24">状态</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <template x-for="(item, idx) in delivery.items" :key="idx">
                                                <tr>
                                                    <td class="text-center text-gray-500" x-text="idx + 1"></td>
                                                    <td>
                                                        <div class="font-medium text-sm" x-text="item.name"></div>
                                                        <div class="text-xs text-gray-400" x-text="'货号：' + (item.artNo || '-')"></div>
                                                    </td>
                                                    <td class="text-xs text-gray-600" x-text="item.spec"></td>
                                                    <td class="text-center text-sm" x-text="item.unit"></td>
                                                    <td class="text-center font-bold" x-text="item.quantity"></td>
                                                    <td class="text-center text-blue-600" x-text="item.delivered"></td>
                                                    <td class="text-center text-green-600 font-medium" x-text="item.stockIn"></td>
                                                    <td class="text-center text-red-500 font-medium" x-text="item.loss"></td>
                                                    <td>
                                                        <span class="text-xs px-2 py-1 rounded border"
                                                              :class="item.status === '已完成' ? 'bg-green-50 text-green-600 border-green-200' : 
                                                                     (item.status === '部分到货' ? 'bg-orange-50 text-orange-600 border-orange-200' : 'bg-gray-50 text-gray-600 border-gray-200')"
                                                              x-text="item.status"></span>
                                                    </td>
                                                </tr>
                                            </template>
                                        </tbody>
                                    </table>
                                    
                                    <!-- 送货单操作记录 -->
                                    <div class="px-4 py-3 bg-gray-50 border-t border-gray-200 text-sm">
                                        <div class="flex items-center gap-2 text-gray-600 mb-2">
                                            <i class="fa-solid fa-truck"></i>
                                            <span class="font-medium">物流信息</span>
                                        </div>
                                        <div class="pl-6 space-y-1 text-xs text-gray-500">
                                            <div>发货时间：<span x-text="delivery.shipTime || '暂未发货'"></span></div>
                                            <div>物流单号：<span x-text="delivery.trackingNo || '-'"></span></div>
                                            <div>预计到达：<span x-text="delivery.estimatedArrival || '待定'"></span></div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- 空状态 -->
                    <div x-show="deliveryList.length === 0" class="text-center py-12 text-gray-400">
                        <i class="fa-solid fa-box-open text-4xl mb-3"></i>
                        <div>暂无送货单数据</div>
                    </div>
                </div>

                <!-- 到货日志Tab -->
                <div x-show="currentTab === 'log'" x-transition>
                    <div class="mb-4 flex justify-between items-center">
                        <h4 class="text-sm font-bold text-gray-800 border-l-4 border-blue-600 pl-3">到货入库日志</h4>
                        <div class="flex gap-2">
                            <select class="border border-gray-300 rounded px-3 py-1 text-sm outline-none focus:border-blue-600" x-model="logFilter">
                                <option value="all">全部记录</option>
                                <option value="stock_in">入库记录</option>
                                <option value="part_arrival">部分到货</option>
                                <option value="loss">损耗记录</option>
                            </select>
                        </div>
                    </div>

                    <div class="space-y-0">
                        <template x-for="(log, index) in filteredLogs" :key="index">
                            <div class="timeline-item" :class="log.type">
                                <div class="timeline-dot"></div>
                                <div class="bg-white border border-gray-200 rounded-lg p-4 shadow-sm">
                                    <div class="flex justify-between items-start mb-2">
                                        <div>
                                            <span class="font-bold text-gray-900 mr-2" x-text="log.operator"></span>
                                            <span class="text-xs text-gray-500" x-text="log.role"></span>
                                            <span class="mx-2 text-gray-300">|</span>
                                            <span class="text-xs text-gray-400" x-text="log.time"></span>
                                        </div>
                                        <span class="text-xs px-2 py-1 rounded border"
                                              :class="log.actionType === '入库' ? 'bg-green-50 text-green-600 border-green-200' : 
                                                     (log.actionType === '部分到货' ? 'bg-blue-50 text-blue-600 border-blue-200' : 
                                                      (log.actionType === '损耗登记' ? 'bg-red-50 text-red-600 border-red-200' : 'bg-gray-50 text-gray-600 border-gray-200'))"
                                              x-text="log.actionType"></span>
                                    </div>
                                    
                                    <div class="text-sm text-gray-700 mb-2" x-text="log.content"></div>
                                    
                                    <!-- 商品明细 -->
                                    <div x-show="log.items && log.items.length > 0" class="mt-3 bg-gray-50 rounded p-3">
                                        <div class="text-xs text-gray-500 mb-2">涉及商品：</div>
                                        <div class="space-y-2">
                                            <template x-for="(item, idx) in log.items" :key="idx">
                                                <div class="flex justify-between text-sm">
                                                    <div class="flex items-center gap-2">
                                                        <span class="text-gray-900" x-text="item.name"></span>
                                                        <span class="text-xs text-gray-500" x-text="item.spec"></span>
                                                    </div>
                                                    <div class="flex gap-4 text-xs">
                                                        <span class="text-blue-600">到货：<span x-text="item.quantity"></span> <span x-text="item.unit"></span></span>
                                                        <span x-show="item.loss > 0" class="text-red-500">损耗：<span x-text="item.loss"></span> <span x-text="item.unit"></span></span>
                                                    </div>
                                                </div>
                                            </template>
                                        </div>
                                    </div>

                                    <!-- 关联送货单 -->
                                    <div class="mt-2 text-xs text-gray-500">
                                        关联送货单：<span class="text-blue-600 cursor-pointer hover:underline" @click="locateDelivery(log.deliveryNo)" x-text="log.deliveryNo"></span>
                                    </div>

                                    <!-- 备注 -->
                                    <div x-show="log.remark" class="mt-2 text-xs text-gray-500 bg-yellow-50 p-2 rounded border border-yellow-100">
                                        <i class="fa-solid fa-note-sticky mr-1"></i>
                                        <span x-text="log.remark"></span>
                                    </div>
                                </div>
                            </div>
                        </template>
                    </div>

                    <!-- 加载更多 -->
                    <div class="text-center mt-6">
                        <button class="text-gray-500 text-sm hover:text-blue-600" @click="loadMoreLogs()" x-show="hasMoreLogs">
                            <i class="fa-solid fa-chevron-down mr-1"></i> 加载更多记录
                        </button>
                    </div>
                </div>

            </div>
        </div>
    </main>

    <!-- 底部固定栏 -->
    <div class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 p-4 shadow-[0_-2px_10px_rgba(0,0,0,0.05)] z-50">
        <div class="max-w-[1400px] mx-auto flex justify-between items-center">
            <button @click="goBack()" class="t-btn t-btn-default">
                <i class="fa-solid fa-arrow-left mr-2"></i> 返回列表
            </button>
            <div class="flex gap-3 text-sm text-gray-500">
                <span>最后更新：<span x-text="lastUpdateTime"></span></span>
            </div>
        </div>
    </div>

    <script>
        function orderDetail() {
            return {
                currentTab: 'detail',
                logFilter: 'all',
                hasMoreLogs: true,
                lastUpdateTime: '2024-01-20 14:30:25',
                
                orderInfo: {
                    orderNo: '中心实验室-20240115-001',
                    status: '待收货',
                    statusType: 'progress',
                    submitter: '张三 (有机分析实验室)',
                    submitTime: '2024-01-15 10:30',
                    institution: '中心实验室',
                    department: '有机分析实验室',
                    urgency: 'urgent',
                    urgencyText: '紧急',
                    deliveryDate: '2024-01-22',
                    deliveryTimeRange: '工作日9:00-17:00',
                    weekendDelivery: '否',
                    approver: '李主任',
                    remark: '急需用于本周三的客户检测项目，请优先处理。',
                    totalAmount: 12580.00,
                    productCount: 3,
                    totalQuantity: 24,
                    receivedQuantity: 14,
                    lossQuantity: 1,
                    completionRate: 58
                },

                products: [
                    { 
                        code: '0101000001', 
                        name: '甲醇（色谱级）', 
                        cas: '67-56-1',
                        artNo: 'M178-4L',
                        spec: '4L/瓶，HPLC级', 
                        brand: 'Sigma',
                        unit: '瓶',
                        price: 128.00, 
                        quantity: 10,
                        received: 10,
                        loss: 0,
                        subtotal: 1280.00
                    },
                    { 
                        code: '0402000001', 
                        name: '10ml一次性离心管（无菌无酶）', 
                        cas: '',
                        artNo: 'GBT-001',
                        spec: 'PP材质，100支/袋', 
                        brand: '洁特',
                        unit: '袋',
                        price: 45.00, 
                        quantity: 10,
                        received: 4,
                        loss: 1,
                        subtotal: 450.00
                    },
                    { 
                        code: '0301000001', 
                        name: 'C18色谱柱', 
                        cas: '',
                        artNo: 'HS-18-250',
                        spec: '4.6×250mm，5μm', 
                        brand: 'Agilent',
                        unit: '支',
                        price: 2850.00, 
                        quantity: 4,
                        received: 0,
                        loss: 0,
                        subtotal: 11400.00
                    }
                ],

                deliveryList: [
                    {
                        deliveryNo: 'SHD-20240115-001',
                        supplierName: '赛默飞世尔科技',
                        createTime: '2024-01-15 11:00',
                        status: '已完成',
                        statusType: 'success',
                        productTypes: 2,
                        totalQuantity: 14,
                        receivedQuantity: 14,
                        lossQuantity: 0,
                        progress: 100,
                        expanded: true,
                        shipTime: '2024-01-16 09:00',
                        trackingNo: 'SF1234567890',
                        estimatedArrival: '2024-01-18',
                        items: [
                            { name: '甲醇（色谱级）', spec: '4L/瓶，HPLC级', unit: '瓶', artNo: 'M178-4L', quantity: 10, delivered: 10, stockIn: 10, loss: 0, status: '已完成' },
                            { name: 'C18色谱柱', spec: '4.6×250mm，5μm', unit: '支', artNo: 'HS-18-250', quantity: 4, delivered: 4, stockIn: 4, loss: 0, status: '已完成' }
                        ]
                    },
                    {
                        deliveryNo: 'SHD-20240115-002',
                        supplierName: '西安化学试剂有限公司',
                        createTime: '2024-01-15 11:05',
                        status: '部分到货',
                        statusType: 'warning',
                        productTypes: 1,
                        totalQuantity: 10,
                        receivedQuantity: 4,
                        lossQuantity: 1,
                        progress: 40,
                        expanded: false,
                        shipTime: '2024-01-17 14:00',
                        trackingNo: 'JD9876543210',
                        estimatedArrival: '2024-01-19',
                        items: [
                            { name: '10ml一次性离心管（无菌无酶）', spec: 'PP材质，100支/袋', unit: '袋', artNo: 'GBT-001', quantity: 10, delivered: 5, stockIn: 4, loss: 1, status: '部分到货' }
                        ]
                    }
                ],

                logList: [
                    {
                        operator: '张三',
                        role: '业务负责人',
                        time: '2024-01-19 10:30:25',
                        actionType: '部分到货',
                        content: '收到西安化学试剂有限公司部分货物，进行入库登记',
                        deliveryNo: 'SHD-20240115-002',
                        items: [
                            { name: '10ml一次性离心管（无菌无酶）', spec: 'PP材质，100支/袋', unit: '袋', quantity: 5, loss: 1 }
                        ],
                        remark: '外包装轻微破损，其中1袋封口不严，已登记损耗',
                        type: 'warning'
                    },
                    {
                        operator: '张三',
                        role: '业务负责人',
                        time: '2024-01-18 16:20:10',
                        actionType: '入库',
                        content: '赛默飞世尔科技送货单已全部到货，验收合格，完成入库',
                        deliveryNo: 'SHD-20240115-001',
                        items: [
                            { name: '甲醇（色谱级）', spec: '4L/瓶，HPLC级', unit: '瓶', quantity: 10, loss: 0 },
                            { name: 'C18色谱柱', spec: '4.6×250mm，5μm', unit: '支', quantity: 4, loss: 0 }
                        ],
                        remark: '商品包装完好，批次号与送货单一致，质检报告齐全',
                        type: 'success'
                    },
                    {
                        operator: '系统',
                        role: '自动通知',
                        time: '2024-01-17 14:00:00',
                        actionType: '发货提醒',
                        content: '供应商【西安化学试剂有限公司】已发货，物流单号：JD9876543210',
                        deliveryNo: 'SHD-20240115-002',
                        items: [],
                        type: ''
                    },
                    {
                        operator: '系统',
                        role: '自动通知',
                        time: '2024-01-16 09:00:00',
                        actionType: '发货提醒',
                        content: '供应商【赛默飞世尔科技】已发货，物流单号：SF1234567890',
                        deliveryNo: 'SHD-20240115-001',
                        items: [],
                        type: ''
                    },
                    {
                        operator: '王管理员',
                        role: '商品管理员',
                        time: '2024-01-15 11:05:00',
                        actionType: '生成送货单',
                        content: '按供应商拆单，生成2个送货单并发送给供应商',
                        deliveryNo: 'SHD-20240115-001, SHD-20240115-002',
                        items: [],
                        remark: '已邮件通知供应商确认订单',
                        type: ''
                    }
                ],

                get filteredLogs() {
                    if (this.logFilter === 'all') return this.logList;
                    const map = {
                        'stock_in': '入库',
                        'part_arrival': '部分到货',
                        'loss': '损耗登记'
                    };
                    return this.logList.filter(log => log.actionType === map[this.logFilter]);
                },

                toggleDeliveryDetail(index) {
                    this.deliveryList[index].expanded = !this.deliveryList[index].expanded;
                },

                formatMoney(amount) {
                    return amount.toLocaleString('zh-CN', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
                },

                locateDelivery(deliveryNo) {
                    this.currentTab = 'delivery';
                    // 高亮对应送货单逻辑
                    setTimeout(() => {
                        const index = this.deliveryList.findIndex(d => deliveryNo.includes(d.deliveryNo));
                        if (index !== -1 && !this.deliveryList[index].expanded) {
                            this.toggleDeliveryDetail(index);
                        }
                    }, 100);
                },

                loadMoreLogs() {
                    // 模拟加载更多
                    alert('加载更多历史记录...');
                },

                exportOrder() {
                    alert('正在导出订单数据...');
                },

                printOrder() {
                    alert('正在打印入库单...');
                },

                goBack() {
                    window.history.back();
                }
            }
        }
    </script>
</body>
</html>
