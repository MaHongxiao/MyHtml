<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>批量修改 - 页面平铺版</title>
    <script src="https://unpkg.com/@phosphor-icons/web"></script>
    <style>
        /* --- 基础变量 --- */
        :root {
            --primary: #1677ff;
            --primary-bg: #e6f4ff;
            --text-main: #1f1f1f;
            --text-sub: #8c8c8c;
            --border: #d9d9d9;
            --border-split: #f0f0f0;
            --bg-body: #f5f7fa;
            --radius: 8px;
        }

        body { 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif; 
            background: var(--bg-body); 
            margin: 0;
            padding: 40px;
            display: flex;
            justify-content: center;
            align-items: flex-start;
            height: 100vh;
            box-sizing: border-box;
        }

        /* --- 主面板样式 (原弹窗样式修改) --- */
        .batch-panel {
            width: 1000px; 
            height: 80vh; /* 固定高度，内部滚动 */
            background: #fff; 
            border-radius: var(--radius);
            display: flex; 
            flex-direction: column; 
            box-shadow: 0 6px 24px rgba(0,0,0,0.08);
            border: 1px solid var(--border-split);
            overflow: hidden;
        }

        .batch-header {
            padding: 16px 24px; border-bottom: 1px solid var(--border-split);
            display: flex; justify-content: space-between; align-items: center;
            background: #fff;
        }
        .batch-title { 
            font-size: 18px; font-weight: 600; color: var(--text-main); 
            display: flex; align-items: center; gap: 10px; 
        }

        /* 主体布局：左侧清单，右侧表单 */
        .batch-body { flex: 1; display: flex; overflow: hidden; }

        /* 左侧：待修改清单 */
        .batch-sider {
            width: 280px; border-right: 1px solid var(--border-split); background: #fdfdfd;
            display: flex; flex-direction: column;
        }
        .sider-header {
            padding: 12px 16px; font-size: 13px; color: var(--text-sub); border-bottom: 1px solid var(--border-split);
            background: #fafafa; display: flex; justify-content: space-between; align-items: center;
        }
        .target-list { flex: 1; overflow-y: auto; padding: 0; margin: 0; list-style: none; }
        .target-item {
            padding: 12px 16px; border-bottom: 1px solid var(--border-split); font-size: 13px;
            display: flex; justify-content: space-between; align-items: flex-start; gap: 10px;
            transition: 0.2s; background: #fff;
        }
        .target-item:hover { background: #f0f7ff; }
        .target-name { font-weight: 600; color: var(--text-main); display: block; margin-bottom: 4px; }
        .target-sub { font-size: 12px; color: var(--text-sub); line-height: 1.4; display: block; }
        .target-remove { cursor: pointer; color: #ccc; padding: 6px; border-radius: 4px; flex-shrink: 0; }
        .target-remove:hover { color: #ff4d4f; background: #fff1f0; }

        /* 右侧：修改表单 */
        .batch-content { flex: 1; padding: 30px; overflow-y: auto; background: #fff; }
        
        .batch-grid { display: grid; grid-template-columns: repeat(2, 1fr); gap: 24px 40px; }
        
        /* 字段组 */
        .field-group {
            border: 1px solid var(--border); border-radius: 6px; padding: 6px 12px 6px 6px;
            display: flex; align-items: center; gap: 12px; transition: 0.2s; background: #fafafa;
        }
        /* 激活状态（勾选后） */
        .field-group.active {
            background: #fff; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(22, 119, 255, 0.1);
        }

        .field-check { margin-left: 8px; transform: scale(1.2); cursor: pointer; }
        
        .field-label {
            font-size: 14px; color: var(--text-main); width: 80px; flex-shrink: 0;
            cursor: pointer; user-select: none; font-weight: 500;
        }
        
        .field-input-wrapper { flex: 1; }
        
        .batch-input, .batch-select {
            width: 100%; height: 36px; border: none; background: transparent;
            font-size: 14px; color: var(--text-main); outline: none;
        }
        .batch-input:disabled, .batch-select:disabled { cursor: not-allowed; color: #bbb; background: transparent; }

        /* 底部 */
        .batch-footer {
            padding: 16px 30px; border-top: 1px solid var(--border-split); text-align: right; background: #fff;
        }

        /* 按钮 */
        .btn { padding: 8px 20px; border-radius: 6px; cursor: pointer; border: 1px solid var(--border); background: #fff; display: inline-flex; align-items: center; gap: 6px; font-size: 14px; transition: 0.2s; }
        .btn:hover { color: var(--primary); border-color: var(--primary); }
        .btn-primary { background: var(--primary); color: #fff; border-color: var(--primary); }
        .btn-primary:hover { background: #4096ff; }

        /* 滚动条美化 */
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; }
        ::-webkit-scrollbar-thumb { background: #ccc; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #999; }
    </style>
</head>
<body>

    <div class="batch-panel">
        <div class="batch-header">
            <div class="batch-title">
                <i class="ph ph-note-pencil" style="color:var(--primary); font-size:24px;"></i>
                批量修改
            </div>
            <div style="font-size:13px; color:var(--text-sub);">
                正在编辑任务：<span style="font-weight:600; color:var(--text-main);">T-20260115-BATCH</span>
            </div>
        </div>

        <div class="batch-body">
            <div class="batch-sider">
                <div class="sider-header">
                    <span>待修改清单 (<span id="selectedCount" style="color:var(--primary); font-weight:bold;">0</span>)</span>
                    <span style="color:var(--primary); cursor:pointer; font-size:12px;" onclick="resetList()">重置</span>
                </div>
                <ul class="target-list" id="targetList">
                    </ul>
            </div>

            <div class="batch-content">
                <div style="margin-bottom: 24px; padding: 12px 16px; background: #e6f4ff; border: 1px solid #91caff; border-radius: 6px; color: #0050b3; font-size: 13px; display: flex; gap: 10px; align-items:flex-start;">
                    <i class="ph ph-info" style="font-size:20px; flex-shrink:0; margin-top:2px;"></i>
                    <div style="line-height: 1.6;">
                        <b>操作指引：</b> 
                        <br>1. 请勾选需要修改的属性字段，勾选后输入框即可编辑。
                        <br>2. 未勾选的字段在提交时将<b>保持原值</b>，不会被覆盖为空。
                    </div>
                </div>

                <div class="batch-grid" id="formContainer">
                    </div>
            </div>
        </div>

        <div class="batch-footer">
            <button class="btn" onclick="alert('取消操作')">取消</button>
            <button class="btn btn-primary" onclick="submitBatchEdit()">
                <i class="ph ph-check-circle"></i> 确认应用修改
            </button>
        </div>
    </div>

    <script>
        // --- 1. 配置：允许批量修改的字段 (排除核心计价字段) ---
        const BATCH_FIELDS = [
            { key: 'service', label: '服务类型', type: 'select', options: ['检定', '校准', '检测'] },
            { key: 'method', label: '检测方式', type: 'select', options: ['带回检测', '现场检测', '上门取样'] },
            { key: 'cert_count', label: '证书数量', type: 'number', placeholder: '请输入数量' },
            { key: 'unit', label: '器具单位', type: 'text', placeholder: '台/件/套' },
            { key: 'urgent', label: '加急天数', type: 'select', options: ['0 (不加急)', '1 (24小时)', '3 (3天)'] },
            { key: 'model', label: '型号规格', type: 'text', placeholder: '输入统一型号' },
            { key: 'range', label: '测量范围', type: 'text', placeholder: '输入统一范围' },
            { key: 'manu', label: '制造厂商', type: 'text', placeholder: '输入厂商名称' },
            { key: 'sn', label: '出厂编号', type: 'text', placeholder: '统一修改编号(慎用)' },
            { key: 'device_no', label: '设备编号', type: 'text', placeholder: '内部管理编号' },
            { key: 'params', label: '检测参数', type: 'text', placeholder: '特定参数要求' },
            { key: 'accessory', label: '器具附件', type: 'text', placeholder: '如: 电源线, 说明书' },
            { key: 'appearance', label: '器具外观', type: 'select', options: ['完好', '划痕', '破损', '油污'] },
            { key: 'double_id', label: '是否双编号', type: 'select', options: ['否', '是'] },
            { key: 'adjust', label: '是否调修', type: 'select', options: ['否', '是'] },
            { key: 'power', label: '电源类型', type: 'text', placeholder: '如: 220V AC' },
            { key: 'usage', label: '器具用途', type: 'text', placeholder: '如: 生产工艺控制' },
            { key: 'remark', label: '备注', type: 'text', placeholder: '补充说明' }
        ];

        // --- 模拟选中的器具数据 ---
        let selectedItems = [
            { id: 101, name: "精密压力表", model: "Y-100", sn: "2023001" },
            { id: 102, name: "精密压力表", model: "Y-100", sn: "2023002" },
            { id: 103, name: "一般压力表", model: "Y-60", sn: "2023005" },
            { id: 104, name: "数字压力计", model: "DP-200", sn: "D2001" },
            { id: 105, name: "压力变送器", model: "PT-300", sn: "P3005" },
        ];

        // --- 2. 初始化逻辑 ---
        
        // 页面加载即渲染
        window.onload = function() {
            renderTargetList();
            renderBatchForm();
        };

        // 渲染左侧待修改列表
        function renderTargetList() {
            const listEl = document.getElementById('targetList');
            document.getElementById('selectedCount').innerText = selectedItems.length;
            listEl.innerHTML = selectedItems.map((item, index) => `
                <li class="target-item" id="target-item-${index}">
                    <div style="flex:1">
                        <span class="target-name">${item.name}</span>
                        <span class="target-sub">型号: ${item.model}</span>
                        <span class="target-sub" style="color:#999">SN: ${item.sn}</span>
                    </div>
                    <i class="ph ph-trash target-remove" onclick="removeTarget(${index})" title="从本次修改中移除"></i>
                </li>
            `).join('');
        }

        // 从清单中移除某一项
        function removeTarget(index) {
            selectedItems.splice(index, 1);
            renderTargetList();
            if (selectedItems.length === 0) {
                document.getElementById('targetList').innerHTML = `<li style="padding:20px; text-align:center; color:#999;">无选中项</li>`;
            }
        }
        
        function resetList() {
            if(confirm("确定清空列表？")) {
                selectedItems = [];
                renderTargetList();
            }
        }

        // 渲染右侧配置化表单
        function renderBatchForm() {
            const container = document.getElementById('formContainer');
            container.innerHTML = BATCH_FIELDS.map(field => {
                let inputHtml = '';
                
                if (field.type === 'select') {
                    const opts = field.options.map(opt => `<option value="${opt}">${opt}</option>`).join('');
                    inputHtml = `
                        <select class="batch-select" id="val_${field.key}" disabled>
                            <option value="" disabled selected>请选择...</option>
                            ${opts}
                        </select>`;
                } else {
                    inputHtml = `
                        <input type="${field.type}" class="batch-input" 
                            id="val_${field.key}" placeholder="${field.placeholder || ''}" disabled>
                    `;
                }

                return `
                    <div class="field-group" id="group_${field.key}" onclick="triggerCheck('${field.key}')">
                        <input type="checkbox" class="field-check" id="chk_${field.key}" onchange="toggleField('${field.key}')" onclick="event.stopPropagation()">
                        <label class="field-label" for="chk_${field.key}">${field.label}</label>
                        <div class="field-input-wrapper">
                            ${inputHtml}
                        </div>
                    </div>
                `;
            }).join('');
        }

        // --- 3. 交互逻辑 ---

        // 点击整个框也可以触发勾选
        function triggerCheck(key) {
            const checkbox = document.getElementById(`chk_${key}`);
            // 只有当点击的不是input/select本身时才触发
            if (document.activeElement !== document.getElementById(`val_${key}`)) {
                checkbox.click();
            }
        }

        // 勾选/取消勾选字段
        function toggleField(key) {
            const checkbox = document.getElementById(`chk_${key}`);
            const input = document.getElementById(`val_${key}`);
            const group = document.getElementById(`group_${key}`);

            if (checkbox.checked) {
                input.disabled = false;
                group.classList.add('active');
                input.focus();
            } else {
                input.disabled = true;
                input.value = ''; // 清空值
                group.classList.remove('active');
            }
        }

        // 提交修改
        function submitBatchEdit() {
            // 1. 收集变更
            const changes = {};
            let hasChanges = false;

            BATCH_FIELDS.forEach(field => {
                const checkbox = document.getElementById(`chk_${field.key}`);
                if (checkbox.checked) {
                    const val = document.getElementById(`val_${field.key}`).value;
                    changes[field.label] = val; // 这里用 label 做演示展示，实际应用 key
                    hasChanges = true;
                }
            });

            if (!hasChanges) {
                alert("请至少勾选一个要修改的字段！");
                return;
            }

            if (selectedItems.length === 0) {
                alert("待修改清单为空！");
                return;
            }

            // 3. 演示反馈
            let confirmMsg = `即将修改 ${selectedItems.length} 条记录：\n\n`;
            for(let key in changes) {
                confirmMsg += `• ${key}: ${changes[key] || '(空)'}\n`;
            }
            
            if(confirm(confirmMsg)) {
                alert("修改成功！页面将自动刷新。");
                // 实际逻辑：window.location.reload() 或回调父级
            }
        }

    </script>
</body>
</html>
